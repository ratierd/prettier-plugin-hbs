import { deprecate, assign } from '@glimmer/util';

function buildMustache(path, params, hash, raw, loc, strip) {
    if (typeof path === 'string') {
        path = buildHead(path);
    }
    return {
        type: 'MustacheStatement',
        path: path,
        params: params || [],
        hash: hash || buildHash([]),
        escaped: !raw,
        loc: buildLoc(loc || null),
        strip: strip || { open: false, close: false }
    };
}
function buildBlock(path, params, hash, _defaultBlock, _elseBlock, loc, openStrip, inverseStrip, closeStrip) {
    var defaultBlock = void 0;
    var elseBlock = void 0;
    if (_defaultBlock.type === 'Template') {
        if (false /* LOCAL_DEBUG */) {
                false && !false && deprecate('b.program is deprecated. Use b.blockItself instead.');
            }
        defaultBlock = assign({}, _defaultBlock, { type: 'Block' });
    } else {
        defaultBlock = _defaultBlock;
    }
    if (_elseBlock !== undefined && _elseBlock !== null && _elseBlock.type === 'Template') {
        if (false /* LOCAL_DEBUG */) {
                false && !false && deprecate('b.program is deprecated. Use b.blockItself instead.');
            }
        elseBlock = assign({}, _elseBlock, { type: 'Block' });
    } else {
        elseBlock = _elseBlock;
    }
    return {
        type: 'BlockStatement',
        path: buildHead(path),
        params: params || [],
        hash: hash || buildHash([]),
        program: defaultBlock || null,
        inverse: elseBlock || null,
        loc: buildLoc(loc || null),
        openStrip: openStrip || { open: false, close: false },
        inverseStrip: inverseStrip || { open: false, close: false },
        closeStrip: closeStrip || { open: false, close: false }
    };
}
function buildElementModifier(path, params, hash, loc) {
    return {
        type: 'ElementModifierStatement',
        path: buildHead(path),
        params: params || [],
        hash: hash || buildHash([]),
        loc: buildLoc(loc || null)
    };
}
function buildPartial(name, params, hash, indent, loc) {
    return {
        type: 'PartialStatement',
        name: name,
        params: params || [],
        hash: hash || buildHash([]),
        indent: indent || '',
        strip: { open: false, close: false },
        loc: buildLoc(loc || null)
    };
}
function buildComment(value, loc) {
    return {
        type: 'CommentStatement',
        value: value,
        loc: buildLoc(loc || null)
    };
}
function buildMustacheComment(value, loc) {
    return {
        type: 'MustacheCommentStatement',
        value: value,
        loc: buildLoc(loc || null)
    };
}
function buildConcat(parts, loc) {
    return {
        type: 'ConcatStatement',
        parts: parts || [],
        loc: buildLoc(loc || null)
    };
}
export function isLocSexp(value) {
    return Array.isArray(value) && value.length === 2 && value[0] === 'loc';
}
export function isParamsSexp(value) {
    return Array.isArray(value) && !isLocSexp(value);
}
export function isHashSexp(value) {
    if (typeof value === 'object' && value && !Array.isArray(value)) {
        expectType(value);
        return true;
    } else {
        return false;
    }
}
function expectType(_input) {
    return;
}
export function normalizeModifier(sexp) {
    if (typeof sexp === 'string') {
        return buildElementModifier(sexp);
    }
    var path = normalizeHead(sexp[0]);
    var params = void 0;
    var hash = void 0;
    var loc = null;
    var parts = sexp.slice(1);
    var next = parts.shift();
    _process: {
        if (isParamsSexp(next)) {
            params = next;
        } else {
            break _process;
        }
        next = parts.shift();
        if (isHashSexp(next)) {
            hash = normalizeHash(next);
        } else {
            break _process;
        }
    }
    if (isLocSexp(next)) {
        loc = next[1];
    }
    return {
        type: 'ElementModifierStatement',
        path: path,
        params: params || [],
        hash: hash || buildHash([]),
        loc: buildLoc(loc || null)
    };
}
export function normalizeAttr(sexp) {
    var name = sexp[0];
    var value = void 0;
    if (typeof sexp[1] === 'string') {
        value = buildText(sexp[1]);
    } else {
        value = sexp[1];
    }
    var loc = sexp[2] ? sexp[2][1] : undefined;
    return buildAttr(name, value, loc);
}
export function normalizeHash(hash, loc) {
    var pairs = [];
    Object.keys(hash).forEach(function (key) {
        pairs.push(buildPair(key, hash[key]));
    });
    return buildHash(pairs, loc);
}
export function normalizeHead(path) {
    if (typeof path === 'string') {
        return buildHead(path);
    } else {
        return buildHead(path[1], path[2] && path[2][1]);
    }
}
export function normalizeElementOptions() {
    var out = {};

    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
    }

    for (var _iterator = args, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {
        var _ref;

        if (_isArray) {
            if (_i >= _iterator.length) break;
            _ref = _iterator[_i++];
        } else {
            _i = _iterator.next();
            if (_i.done) break;
            _ref = _i.value;
        }

        var arg = _ref;

        switch (arg[0]) {
            case 'attrs':
                {
                    var rest = arg.slice(1);

                    out.attrs = rest.map(normalizeAttr);
                    break;
                }
            case 'modifiers':
                {
                    var _rest = arg.slice(1);

                    out.modifiers = _rest.map(normalizeModifier);
                    break;
                }
            case 'body':
                {
                    var _rest2 = arg.slice(1);

                    out.children = _rest2;
                    break;
                }
            case 'comments':
                {
                    var _rest3 = arg.slice(1);

                    out.comments = _rest3;
                    break;
                }
            case 'as':
                {
                    var _rest4 = arg.slice(1);

                    out.blockParams = _rest4;
                    break;
                }
            case 'loc':
                {
                    var _rest5 = arg[1];

                    out.loc = _rest5;
                    break;
                }
        }
    }
    return out;
}
function buildElement(tag, options) {
    var normalized = void 0;
    if (Array.isArray(options)) {
        for (var _len2 = arguments.length, rest = Array(_len2 > 2 ? _len2 - 2 : 0), _key2 = 2; _key2 < _len2; _key2++) {
            rest[_key2 - 2] = arguments[_key2];
        }

        normalized = normalizeElementOptions.apply(undefined, [options].concat(rest));
    } else {
        normalized = options || {};
    }
    var _normalized = normalized,
        attrs = _normalized.attrs,
        blockParams = _normalized.blockParams,
        modifiers = _normalized.modifiers,
        comments = _normalized.comments,
        children = _normalized.children,
        loc = _normalized.loc;
    // this is used for backwards compat, prior to `selfClosing` being part of the ElementNode AST

    var selfClosing = false;
    if (typeof tag === 'object') {
        selfClosing = tag.selfClosing;
        tag = tag.name;
    } else {
        if (tag.slice(-1) === '/') {
            tag = tag.slice(0, -1);
            selfClosing = true;
        }
    }
    return {
        type: 'ElementNode',
        tag: tag || '',
        selfClosing: selfClosing,
        attributes: attrs || [],
        blockParams: blockParams || [],
        modifiers: modifiers || [],
        comments: comments || [],
        children: children || [],
        loc: buildLoc(loc || null)
    };
}
function buildAttr(name, value, loc) {
    return {
        type: 'AttrNode',
        name: name,
        value: value,
        loc: buildLoc(loc || null)
    };
}
function buildText(chars, loc) {
    return {
        type: 'TextNode',
        chars: chars || '',
        loc: buildLoc(loc || null)
    };
}
// Expressions
function buildSexpr(path, params, hash, loc) {
    return {
        type: 'SubExpression',
        path: buildHead(path),
        params: params || [],
        hash: hash || buildHash([]),
        loc: buildLoc(loc || null)
    };
}
function buildHead(original, loc) {
    if (typeof original !== 'string') return original;
    var parts = original.split('.');
    var thisHead = false;
    if (parts[0] === 'this') {
        thisHead = true;
        parts = parts.slice(1);
    }
    return {
        type: 'PathExpression',
        original: original,
        this: thisHead,
        parts: parts,
        data: false,
        loc: buildLoc(loc || null)
    };
}
function buildLiteral(type, value, loc) {
    return {
        type: type,
        value: value,
        original: value,
        loc: buildLoc(loc || null)
    };
}
// Miscellaneous
function buildHash(pairs, loc) {
    return {
        type: 'Hash',
        pairs: pairs || [],
        loc: buildLoc(loc || null)
    };
}
function buildPair(key, value, loc) {
    return {
        type: 'HashPair',
        key: key,
        value: value,
        loc: buildLoc(loc || null)
    };
}
function buildProgram(body, blockParams, loc) {
    return {
        type: 'Template',
        body: body || [],
        blockParams: blockParams || [],
        loc: buildLoc(loc || null)
    };
}
function buildBlockItself(body, blockParams) {
    var chained = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
    var loc = arguments[3];

    return {
        type: 'Block',
        body: body || [],
        blockParams: blockParams || [],
        chained: chained,
        loc: buildLoc(loc || null)
    };
}
function buildTemplate(body, blockParams, loc) {
    return {
        type: 'Template',
        body: body || [],
        blockParams: blockParams || [],
        loc: buildLoc(loc || null)
    };
}
function buildSource(source) {
    return source || null;
}
function buildPosition(line, column) {
    return {
        line: line,
        column: column
    };
}
export var SYNTHETIC = {
    source: '(synthetic)',
    start: { line: 1, column: 0 },
    end: { line: 1, column: 0 }
};
function buildLoc() {
    for (var _len3 = arguments.length, args = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
        args[_key3] = arguments[_key3];
    }

    if (args.length === 1) {
        var loc = args[0];
        if (loc && typeof loc === 'object') {
            return {
                source: buildSource(loc.source),
                start: buildPosition(loc.start.line, loc.start.column),
                end: buildPosition(loc.end.line, loc.end.column)
            };
        } else {
            return SYNTHETIC;
        }
    } else {
        var startLine = args[0],
            startColumn = args[1],
            endLine = args[2],
            endColumn = args[3],
            source = args[4];

        return {
            source: buildSource(source),
            start: buildPosition(startLine, startColumn),
            end: buildPosition(endLine, endColumn)
        };
    }
}
export default {
    mustache: buildMustache,
    block: buildBlock,
    partial: buildPartial,
    comment: buildComment,
    mustacheComment: buildMustacheComment,
    element: buildElement,
    elementModifier: buildElementModifier,
    attr: buildAttr,
    text: buildText,
    sexpr: buildSexpr,
    path: buildHead,
    concat: buildConcat,
    hash: buildHash,
    pair: buildPair,
    literal: buildLiteral,
    program: buildProgram,
    blockItself: buildBlockItself,
    template: buildTemplate,
    loc: buildLoc,
    pos: buildPosition,
    string: literal('StringLiteral'),
    boolean: literal('BooleanLiteral'),
    number: literal('NumberLiteral'),
    undefined: function (_undefined) {
        function undefined() {
            return _undefined.apply(this, arguments);
        }

        undefined.toString = function () {
            return _undefined.toString();
        };

        return undefined;
    }(function () {
        return buildLiteral('UndefinedLiteral', undefined);
    }),
    null: function _null() {
        return buildLiteral('NullLiteral', null);
    }
};
function literal(type) {
    return function (value) {
        return buildLiteral(type, value);
    };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL3N5bnRheC9saWIvYnVpbGRlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsU0FBQSxTQUFBLEVBQUEsTUFBQSxRQUFBLGVBQUE7O0FBU0EsU0FBQSxhQUFBLENBQUEsSUFBQSxFQUFBLE1BQUEsRUFBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLEdBQUEsRUFBQSxLQUFBLEVBTXdCO0FBRXRCLFFBQUksT0FBQSxJQUFBLEtBQUosUUFBQSxFQUE4QjtBQUM1QixlQUFPLFVBQVAsSUFBTyxDQUFQO0FBQ0Q7QUFFRCxXQUFPO0FBQ0wsY0FESyxtQkFBQTtBQUFBLGtCQUFBO0FBR0wsZ0JBQVEsVUFISCxFQUFBO0FBSUwsY0FBTSxRQUFRLFVBSlQsRUFJUyxDQUpUO0FBS0wsaUJBQVMsQ0FMSixHQUFBO0FBTUwsYUFBSyxTQUFTLE9BTlQsSUFNQSxDQU5BO0FBT0wsZUFBTyxTQUFTLEVBQUUsTUFBRixLQUFBLEVBQWUsT0FBZixLQUFBO0FBUFgsS0FBUDtBQVNEO0FBRUQsU0FBQSxVQUFBLENBQUEsSUFBQSxFQUFBLE1BQUEsRUFBQSxJQUFBLEVBQUEsYUFBQSxFQUFBLFVBQUEsRUFBQSxHQUFBLEVBQUEsU0FBQSxFQUFBLFlBQUEsRUFBQSxVQUFBLEVBUzZCO0FBRTNCLFFBQUEscUJBQUE7QUFDQSxRQUFBLGtCQUFBO0FBRUEsUUFBSSxjQUFBLElBQUEsS0FBSixVQUFBLEVBQXVDO0FBQ3JDLFlBQUEsS0FBQSxDQUFBLGlCQUFBLEVBQWlCO0FBQUEseUJBQUEsQ0FBQSxLQUFBLElBQUEsZ0VBQUE7QUFFaEI7QUFFRCx1QkFBZ0IsT0FBQSxFQUFBLEVBQUEsYUFBQSxFQUEwQixFQUFFLE1BQTVDLE9BQTBDLEVBQTFCLENBQWhCO0FBTEYsS0FBQSxNQU1PO0FBQ0wsdUJBQUEsYUFBQTtBQUNEO0FBRUQsUUFBSSxlQUFBLFNBQUEsSUFBNEIsZUFBNUIsSUFBQSxJQUFtRCxXQUFBLElBQUEsS0FBdkQs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OztBQUFBO0FBQUEsa0JBeUJKO0FBQ1AsZUFBTyxhQUFBLGtCQUFBLEVBQVAsU0FBTyxDQUFQO0FBMUJXLEtBQUE7QUE0QmIsUUE1QmEsbUJBNEJUO0FBQ0YsZUFBTyxhQUFBLGFBQUEsRUFBUCxJQUFPLENBQVA7QUFDRDtBQTlCWSxDQUFmO0FBbUNBLFNBQUEsT0FBQSxDQUFBLElBQUEsRUFBdUQ7QUFDckQsV0FBTyxVQUFBLEtBQUEsRUFBMEI7QUFDL0IsZUFBTyxhQUFBLElBQUEsRUFBUCxLQUFPLENBQVA7QUFERixLQUFBO0FBR0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBBU1QgZnJvbSAnLi90eXBlcy9ub2Rlcyc7XG5pbXBvcnQgeyBPcHRpb24sIERpY3QgfSBmcm9tICdAZ2xpbW1lci9pbnRlcmZhY2VzJztcbmltcG9ydCB7IGRlcHJlY2F0ZSwgYXNzaWduIH0gZnJvbSAnQGdsaW1tZXIvdXRpbCc7XG5pbXBvcnQgeyBMT0NBTF9ERUJVRyB9IGZyb20gJ0BnbGltbWVyL2xvY2FsLWRlYnVnLWZsYWdzJztcbmltcG9ydCB7IFN0cmluZ0xpdGVyYWwsIEJvb2xlYW5MaXRlcmFsLCBOdW1iZXJMaXRlcmFsIH0gZnJvbSAnLi90eXBlcy9oYW5kbGViYXJzLWFzdCc7XG5cbi8vIFN0YXRlbWVudHNcblxuZXhwb3J0IHR5cGUgQnVpbGRlckhlYWQgPSBzdHJpbmcgfCBBU1QuRXhwcmVzc2lvbjtcbmV4cG9ydCB0eXBlIFRhZ0Rlc2NyaXB0b3IgPSBzdHJpbmcgfCB7IG5hbWU6IHN0cmluZzsgc2VsZkNsb3Npbmc6IGJvb2xlYW4gfTtcblxuZnVuY3Rpb24gYnVpbGRNdXN0YWNoZShcbiAgcGF0aDogQnVpbGRlckhlYWQgfCBBU1QuTGl0ZXJhbCxcbiAgcGFyYW1zPzogQVNULkV4cHJlc3Npb25bXSxcbiAgaGFzaD86IEFTVC5IYXNoLFxuICByYXc/OiBib29sZWFuLFxuICBsb2M/OiBBU1QuU291cmNlTG9jYXRpb24sXG4gIHN0cmlwPzogQVNULlN0cmlwRmxhZ3Ncbik6IEFTVC5NdXN0YWNoZVN0YXRlbWVudCB7XG4gIGlmICh0eXBlb2YgcGF0aCA9PT0gJ3N0cmluZycpIHtcbiAgICBwYXRoID0gYnVpbGRIZWFkKHBhdGgpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnTXVzdGFjaGVTdGF0ZW1lbnQnLFxuICAgIHBhdGgsXG4gICAgcGFyYW1zOiBwYXJhbXMgfHwgW10sXG4gICAgaGFzaDogaGFzaCB8fCBidWlsZEhhc2goW10pLFxuICAgIGVzY2FwZWQ6ICFyYXcsXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gICAgc3RyaXA6IHN0cmlwIHx8IHsgb3BlbjogZmFsc2UsIGNsb3NlOiBmYWxzZSB9LFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZEJsb2NrKFxuICBwYXRoOiBCdWlsZGVySGVhZCxcbiAgcGFyYW1zOiBPcHRpb248QVNULkV4cHJlc3Npb25bXT4sXG4gIGhhc2g6IE9wdGlvbjxBU1QuSGFzaD4sXG4gIF9kZWZhdWx0QmxvY2s6IEFTVC5Qb3NzaWJseURlcHJlY2F0ZWRCbG9jayxcbiAgX2Vsc2VCbG9jaz86IE9wdGlvbjxBU1QuUG9zc2libHlEZXByZWNhdGVkQmxvY2s+LFxuICBsb2M/OiBBU1QuU291cmNlTG9jYXRpb24sXG4gIG9wZW5TdHJpcD86IEFTVC5TdHJpcEZsYWdzLFxuICBpbnZlcnNlU3RyaXA/OiBBU1QuU3RyaXBGbGFncyxcbiAgY2xvc2VTdHJpcD86IEFTVC5TdHJpcEZsYWdzXG4pOiBBU1QuQmxvY2tTdGF0ZW1lbnQge1xuICBsZXQgZGVmYXVsdEJsb2NrOiBBU1QuQmxvY2s7XG4gIGxldCBlbHNlQmxvY2s6IE9wdGlvbjxBU1QuQmxvY2s+IHwgdW5kZWZpbmVkO1xuXG4gIGlmIChfZGVmYXVsdEJsb2NrLnR5cGUgPT09ICdUZW1wbGF0ZScpIHtcbiAgICBpZiAoTE9DQUxfREVCVUcpIHtcbiAgICAgIGRlcHJlY2F0ZShgYi5wcm9ncmFtIGlzIGRlcHJlY2F0ZWQuIFVzZSBiLmJsb2NrSXRzZWxmIGluc3RlYWQuYCk7XG4gICAgfVxuXG4gICAgZGVmYXVsdEJsb2NrID0gKGFzc2lnbih7fSwgX2RlZmF1bHRCbG9jaywgeyB0eXBlOiAnQmxvY2snIH0pIGFzIHVua25vd24pIGFzIEFTVC5CbG9jaztcbiAgfSBlbHNlIHtcbiAgICBkZWZhdWx0QmxvY2sgPSBfZGVmYXVsdEJsb2NrO1xuICB9XG5cbiAgaWYgKF9lbHNlQmxvY2sgIT09IHVuZGVmaW5lZCAmJiBfZWxzZUJsb2NrICE9PSBudWxsICYmIF9lbHNlQmxvY2sudHlwZSA9PT0gJ1RlbXBsYXRlJykge1xuICAgIGlmIChMT0NBTF9ERUJVRykge1xuICAgICAgZGVwcmVjYXRlKGBiLnByb2dyYW0gaXMgZGVwcmVjYXRlZC4gVXNlIGIuYmxvY2tJdHNlbGYgaW5zdGVhZC5gKTtcbiAgICB9XG5cbiAgICBlbHNlQmxvY2sgPSAoYXNzaWduKHt9LCBfZWxzZUJsb2NrLCB7IHR5cGU6ICdCbG9jaycgfSkgYXMgdW5rbm93bikgYXMgQVNULkJsb2NrO1xuICB9IGVsc2Uge1xuICAgIGVsc2VCbG9jayA9IF9lbHNlQmxvY2s7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHR5cGU6ICdCbG9ja1N0YXRlbWVudCcsXG4gICAgcGF0aDogYnVpbGRIZWFkKHBhdGgpLFxuICAgIHBhcmFtczogcGFyYW1zIHx8IFtdLFxuICAgIGhhc2g6IGhhc2ggfHwgYnVpbGRIYXNoKFtdKSxcbiAgICBwcm9ncmFtOiBkZWZhdWx0QmxvY2sgfHwgbnVsbCxcbiAgICBpbnZlcnNlOiBlbHNlQmxvY2sgfHwgbnVsbCxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgICBvcGVuU3RyaXA6IG9wZW5TdHJpcCB8fCB7IG9wZW46IGZhbHNlLCBjbG9zZTogZmFsc2UgfSxcbiAgICBpbnZlcnNlU3RyaXA6IGludmVyc2VTdHJpcCB8fCB7IG9wZW46IGZhbHNlLCBjbG9zZTogZmFsc2UgfSxcbiAgICBjbG9zZVN0cmlwOiBjbG9zZVN0cmlwIHx8IHsgb3BlbjogZmFsc2UsIGNsb3NlOiBmYWxzZSB9LFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZEVsZW1lbnRNb2RpZmllcihcbiAgcGF0aDogQnVpbGRlckhlYWQsXG4gIHBhcmFtcz86IEFTVC5FeHByZXNzaW9uW10sXG4gIGhhc2g/OiBBU1QuSGFzaCxcbiAgbG9jPzogT3B0aW9uPEFTVC5Tb3VyY2VMb2NhdGlvbj5cbik6IEFTVC5FbGVtZW50TW9kaWZpZXJTdGF0ZW1lbnQge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdFbGVtZW50TW9kaWZpZXJTdGF0ZW1lbnQnLFxuICAgIHBhdGg6IGJ1aWxkSGVhZChwYXRoKSxcbiAgICBwYXJhbXM6IHBhcmFtcyB8fCBbXSxcbiAgICBoYXNoOiBoYXNoIHx8IGJ1aWxkSGFzaChbXSksXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH07XG59XG5cbmZ1bmN0aW9uIGJ1aWxkUGFydGlhbChcbiAgbmFtZTogQVNULlBhdGhFeHByZXNzaW9uLFxuICBwYXJhbXM/OiBBU1QuRXhwcmVzc2lvbltdLFxuICBoYXNoPzogQVNULkhhc2gsXG4gIGluZGVudD86IHN0cmluZyxcbiAgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uXG4pOiBBU1QuUGFydGlhbFN0YXRlbWVudCB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ1BhcnRpYWxTdGF0ZW1lbnQnLFxuICAgIG5hbWU6IG5hbWUsXG4gICAgcGFyYW1zOiBwYXJhbXMgfHwgW10sXG4gICAgaGFzaDogaGFzaCB8fCBidWlsZEhhc2goW10pLFxuICAgIGluZGVudDogaW5kZW50IHx8ICcnLFxuICAgIHN0cmlwOiB7IG9wZW46IGZhbHNlLCBjbG9zZTogZmFsc2UgfSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRDb21tZW50KHZhbHVlOiBzdHJpbmcsIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvbik6IEFTVC5Db21tZW50U3RhdGVtZW50IHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnQ29tbWVudFN0YXRlbWVudCcsXG4gICAgdmFsdWU6IHZhbHVlLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZE11c3RhY2hlQ29tbWVudChcbiAgdmFsdWU6IHN0cmluZyxcbiAgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uXG4pOiBBU1QuTXVzdGFjaGVDb21tZW50U3RhdGVtZW50IHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnTXVzdGFjaGVDb21tZW50U3RhdGVtZW50JyxcbiAgICB2YWx1ZTogdmFsdWUsXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH07XG59XG5cbmZ1bmN0aW9uIGJ1aWxkQ29uY2F0KFxuICBwYXJ0czogKEFTVC5UZXh0Tm9kZSB8IEFTVC5NdXN0YWNoZVN0YXRlbWVudClbXSxcbiAgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uXG4pOiBBU1QuQ29uY2F0U3RhdGVtZW50IHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnQ29uY2F0U3RhdGVtZW50JyxcbiAgICBwYXJ0czogcGFydHMgfHwgW10sXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH07XG59XG5cbi8vIE5vZGVzXG5cbmV4cG9ydCB0eXBlIEVsZW1lbnRBcmdzID1cbiAgfCBbJ2F0dHJzJywgLi4uQXR0clNleHBbXV1cbiAgfCBbJ21vZGlmaWVycycsIC4uLk1vZGlmaWVyU2V4cFtdXVxuICB8IFsnYm9keScsIC4uLkFTVC5TdGF0ZW1lbnRbXV1cbiAgfCBbJ2NvbW1lbnRzJywgLi4uRWxlbWVudENvbW1lbnRbXV1cbiAgfCBbJ2FzJywgLi4uc3RyaW5nW11dXG4gIHwgWydsb2MnLCBBU1QuU291cmNlTG9jYXRpb25dO1xuXG5leHBvcnQgdHlwZSBQYXRoU2V4cCA9IHN0cmluZyB8IFsncGF0aCcsIHN0cmluZywgTG9jU2V4cD9dO1xuXG5leHBvcnQgdHlwZSBNb2RpZmllclNleHAgPVxuICB8IHN0cmluZ1xuICB8IFtQYXRoU2V4cCwgTG9jU2V4cD9dXG4gIHwgW1BhdGhTZXhwLCBBU1QuRXhwcmVzc2lvbltdLCBMb2NTZXhwP11cbiAgfCBbUGF0aFNleHAsIEFTVC5FeHByZXNzaW9uW10sIERpY3Q8QVNULkV4cHJlc3Npb24+LCBMb2NTZXhwP107XG5cbmV4cG9ydCB0eXBlIEF0dHJTZXhwID0gW3N0cmluZywgQVNULkF0dHJOb2RlWyd2YWx1ZSddIHwgc3RyaW5nLCBMb2NTZXhwP107XG5cbmV4cG9ydCB0eXBlIExvY1NleHAgPSBbJ2xvYycsIEFTVC5Tb3VyY2VMb2NhdGlvbl07XG5cbmV4cG9ydCB0eXBlIEVsZW1lbnRDb21tZW50ID0gQVNULk11c3RhY2hlQ29tbWVudFN0YXRlbWVudCB8IEFTVC5Tb3VyY2VMb2NhdGlvbiB8IHN0cmluZztcblxuZXhwb3J0IHR5cGUgU2V4cFZhbHVlID1cbiAgfCBzdHJpbmdcbiAgfCBBU1QuRXhwcmVzc2lvbltdXG4gIHwgRGljdDxBU1QuRXhwcmVzc2lvbj5cbiAgfCBMb2NTZXhwXG4gIHwgUGF0aFNleHBcbiAgfCB1bmRlZmluZWQ7XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0xvY1NleHAodmFsdWU6IFNleHBWYWx1ZSk6IHZhbHVlIGlzIExvY1NleHAge1xuICByZXR1cm4gQXJyYXkuaXNBcnJheSh2YWx1ZSkgJiYgdmFsdWUubGVuZ3RoID09PSAyICYmIHZhbHVlWzBdID09PSAnbG9jJztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzUGFyYW1zU2V4cCh2YWx1ZTogU2V4cFZhbHVlKTogdmFsdWUgaXMgQVNULkV4cHJlc3Npb25bXSB7XG4gIHJldHVybiBBcnJheS5pc0FycmF5KHZhbHVlKSAmJiAhaXNMb2NTZXhwKHZhbHVlKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzSGFzaFNleHAodmFsdWU6IFNleHBWYWx1ZSk6IHZhbHVlIGlzIERpY3Q8QVNULkV4cHJlc3Npb24+IHtcbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgIUFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgZXhwZWN0VHlwZTxEaWN0PEFTVC5FeHByZXNzaW9uPj4odmFsdWUpO1xuICAgIHJldHVybiB0cnVlO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG5mdW5jdGlvbiBleHBlY3RUeXBlPFQ+KF9pbnB1dDogVCk6IHZvaWQge1xuICByZXR1cm47XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBub3JtYWxpemVNb2RpZmllcihzZXhwOiBNb2RpZmllclNleHApOiBBU1QuRWxlbWVudE1vZGlmaWVyU3RhdGVtZW50IHtcbiAgaWYgKHR5cGVvZiBzZXhwID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBidWlsZEVsZW1lbnRNb2RpZmllcihzZXhwKTtcbiAgfVxuXG4gIGxldCBwYXRoOiBBU1QuRXhwcmVzc2lvbiA9IG5vcm1hbGl6ZUhlYWQoc2V4cFswXSk7XG4gIGxldCBwYXJhbXM6IEFTVC5FeHByZXNzaW9uW10gfCB1bmRlZmluZWQ7XG4gIGxldCBoYXNoOiBBU1QuSGFzaCB8IHVuZGVmaW5lZDtcbiAgbGV0IGxvYzogQVNULlNvdXJjZUxvY2F0aW9uIHwgbnVsbCA9IG51bGw7XG5cbiAgbGV0IHBhcnRzID0gc2V4cC5zbGljZSgxKTtcbiAgbGV0IG5leHQgPSBwYXJ0cy5zaGlmdCgpO1xuXG4gIF9wcm9jZXNzOiB7XG4gICAgaWYgKGlzUGFyYW1zU2V4cChuZXh0KSkge1xuICAgICAgcGFyYW1zID0gbmV4dCBhcyBBU1QuRXhwcmVzc2lvbltdO1xuICAgIH0gZWxzZSB7XG4gICAgICBicmVhayBfcHJvY2VzcztcbiAgICB9XG5cbiAgICBuZXh0ID0gcGFydHMuc2hpZnQoKTtcblxuICAgIGlmIChpc0hhc2hTZXhwKG5leHQpKSB7XG4gICAgICBoYXNoID0gbm9ybWFsaXplSGFzaChuZXh0IGFzIERpY3Q8QVNULkV4cHJlc3Npb24+KTtcbiAgICB9IGVsc2Uge1xuICAgICAgYnJlYWsgX3Byb2Nlc3M7XG4gICAgfVxuICB9XG5cbiAgaWYgKGlzTG9jU2V4cChuZXh0KSkge1xuICAgIGxvYyA9IG5leHRbMV07XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHR5cGU6ICdFbGVtZW50TW9kaWZpZXJTdGF0ZW1lbnQnLFxuICAgIHBhdGgsXG4gICAgcGFyYW1zOiBwYXJhbXMgfHwgW10sXG4gICAgaGFzaDogaGFzaCB8fCBidWlsZEhhc2goW10pLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbm9ybWFsaXplQXR0cihzZXhwOiBBdHRyU2V4cCk6IEFTVC5BdHRyTm9kZSB7XG4gIGxldCBuYW1lID0gc2V4cFswXTtcbiAgbGV0IHZhbHVlO1xuXG4gIGlmICh0eXBlb2Ygc2V4cFsxXSA9PT0gJ3N0cmluZycpIHtcbiAgICB2YWx1ZSA9IGJ1aWxkVGV4dChzZXhwWzFdKTtcbiAgfSBlbHNlIHtcbiAgICB2YWx1ZSA9IHNleHBbMV07XG4gIH1cblxuICBsZXQgbG9jID0gc2V4cFsyXSA/IHNleHBbMl1bMV0gOiB1bmRlZmluZWQ7XG5cbiAgcmV0dXJuIGJ1aWxkQXR0cihuYW1lLCB2YWx1ZSwgbG9jKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZUhhc2goaGFzaDogRGljdDxBU1QuRXhwcmVzc2lvbj4sIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvbik6IEFTVC5IYXNoIHtcbiAgbGV0IHBhaXJzOiBBU1QuSGFzaFBhaXJbXSA9IFtdO1xuXG4gIE9iamVjdC5rZXlzKGhhc2gpLmZvckVhY2goa2V5ID0+IHtcbiAgICBwYWlycy5wdXNoKGJ1aWxkUGFpcihrZXksIGhhc2hba2V5XSkpO1xuICB9KTtcblxuICByZXR1cm4gYnVpbGRIYXNoKHBhaXJzLCBsb2MpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbm9ybWFsaXplSGVhZChwYXRoOiBQYXRoU2V4cCk6IEFTVC5FeHByZXNzaW9uIHtcbiAgaWYgKHR5cGVvZiBwYXRoID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBidWlsZEhlYWQocGF0aCk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGJ1aWxkSGVhZChwYXRoWzFdLCBwYXRoWzJdICYmIHBhdGhbMl1bMV0pO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBub3JtYWxpemVFbGVtZW50T3B0aW9ucyguLi5hcmdzOiBFbGVtZW50QXJnc1tdKTogQnVpbGRFbGVtZW50T3B0aW9ucyB7XG4gIGxldCBvdXQ6IEJ1aWxkRWxlbWVudE9wdGlvbnMgPSB7fTtcblxuICBmb3IgKGxldCBhcmcgb2YgYXJncykge1xuICAgIHN3aXRjaCAoYXJnWzBdKSB7XG4gICAgICBjYXNlICdhdHRycyc6IHtcbiAgICAgICAgbGV0IFssIC4uLnJlc3RdID0gYXJnO1xuICAgICAgICBvdXQuYXR0cnMgPSByZXN0Lm1hcChub3JtYWxpemVBdHRyKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlICdtb2RpZmllcnMnOiB7XG4gICAgICAgIGxldCBbLCAuLi5yZXN0XSA9IGFyZztcbiAgICAgICAgb3V0Lm1vZGlmaWVycyA9IHJlc3QubWFwKG5vcm1hbGl6ZU1vZGlmaWVyKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlICdib2R5Jzoge1xuICAgICAgICBsZXQgWywgLi4ucmVzdF0gPSBhcmc7XG4gICAgICAgIG91dC5jaGlsZHJlbiA9IHJlc3Q7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSAnY29tbWVudHMnOiB7XG4gICAgICAgIGxldCBbLCAuLi5yZXN0XSA9IGFyZztcblxuICAgICAgICBvdXQuY29tbWVudHMgPSByZXN0O1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgJ2FzJzoge1xuICAgICAgICBsZXQgWywgLi4ucmVzdF0gPSBhcmc7XG4gICAgICAgIG91dC5ibG9ja1BhcmFtcyA9IHJlc3Q7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSAnbG9jJzoge1xuICAgICAgICBsZXQgWywgcmVzdF0gPSBhcmc7XG4gICAgICAgIG91dC5sb2MgPSByZXN0O1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gb3V0O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEJ1aWxkRWxlbWVudE9wdGlvbnMge1xuICBhdHRycz86IEFTVC5BdHRyTm9kZVtdO1xuICBtb2RpZmllcnM/OiBBU1QuRWxlbWVudE1vZGlmaWVyU3RhdGVtZW50W107XG4gIGNoaWxkcmVuPzogQVNULlN0YXRlbWVudFtdO1xuICBjb21tZW50cz86IEVsZW1lbnRDb21tZW50W107XG4gIGJsb2NrUGFyYW1zPzogc3RyaW5nW107XG4gIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvbjtcbn1cblxuZnVuY3Rpb24gYnVpbGRFbGVtZW50KHRhZzogVGFnRGVzY3JpcHRvciwgb3B0aW9ucz86IEJ1aWxkRWxlbWVudE9wdGlvbnMpOiBBU1QuRWxlbWVudE5vZGU7XG5mdW5jdGlvbiBidWlsZEVsZW1lbnQodGFnOiBUYWdEZXNjcmlwdG9yLCAuLi5vcHRpb25zOiBFbGVtZW50QXJnc1tdKTogQVNULkVsZW1lbnROb2RlO1xuZnVuY3Rpb24gYnVpbGRFbGVtZW50KFxuICB0YWc6IFRhZ0Rlc2NyaXB0b3IsXG4gIG9wdGlvbnM/OiBCdWlsZEVsZW1lbnRPcHRpb25zIHwgRWxlbWVudEFyZ3MsXG4gIC4uLnJlc3Q6IEVsZW1lbnRBcmdzW11cbik6IEFTVC5FbGVtZW50Tm9kZSB7XG4gIGxldCBub3JtYWxpemVkOiBCdWlsZEVsZW1lbnRPcHRpb25zO1xuICBpZiAoQXJyYXkuaXNBcnJheShvcHRpb25zKSkge1xuICAgIG5vcm1hbGl6ZWQgPSBub3JtYWxpemVFbGVtZW50T3B0aW9ucyhvcHRpb25zLCAuLi5yZXN0KTtcbiAgfSBlbHNlIHtcbiAgICBub3JtYWxpemVkID0gb3B0aW9ucyB8fCB7fTtcbiAgfVxuXG4gIGxldCB7IGF0dHJzLCBibG9ja1BhcmFtcywgbW9kaWZpZXJzLCBjb21tZW50cywgY2hpbGRyZW4sIGxvYyB9ID0gbm9ybWFsaXplZDtcblxuICAvLyB0aGlzIGlzIHVzZWQgZm9yIGJhY2t3YXJkcyBjb21wYXQsIHByaW9yIHRvIGBzZWxmQ2xvc2luZ2AgYmVpbmcgcGFydCBvZiB0aGUgRWxlbWVudE5vZGUgQVNUXG4gIGxldCBzZWxmQ2xvc2luZyA9IGZhbHNlO1xuICBpZiAodHlwZW9mIHRhZyA9PT0gJ29iamVjdCcpIHtcbiAgICBzZWxmQ2xvc2luZyA9IHRhZy5zZWxmQ2xvc2luZztcbiAgICB0YWcgPSB0YWcubmFtZTtcbiAgfSBlbHNlIHtcbiAgICBpZiAodGFnLnNsaWNlKC0xKSA9PT0gJy8nKSB7XG4gICAgICB0YWcgPSB0YWcuc2xpY2UoMCwgLTEpO1xuICAgICAgc2VsZkNsb3NpbmcgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7XG4gICAgdHlwZTogJ0VsZW1lbnROb2RlJyxcbiAgICB0YWc6IHRhZyB8fCAnJyxcbiAgICBzZWxmQ2xvc2luZzogc2VsZkNsb3NpbmcsXG4gICAgYXR0cmlidXRlczogYXR0cnMgfHwgW10sXG4gICAgYmxvY2tQYXJhbXM6IGJsb2NrUGFyYW1zIHx8IFtdLFxuICAgIG1vZGlmaWVyczogbW9kaWZpZXJzIHx8IFtdLFxuICAgIGNvbW1lbnRzOiAoY29tbWVudHMgYXMgQVNULk11c3RhY2hlQ29tbWVudFN0YXRlbWVudFtdKSB8fCBbXSxcbiAgICBjaGlsZHJlbjogY2hpbGRyZW4gfHwgW10sXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH07XG59XG5cbmZ1bmN0aW9uIGJ1aWxkQXR0cihcbiAgbmFtZTogc3RyaW5nLFxuICB2YWx1ZTogQVNULkF0dHJOb2RlWyd2YWx1ZSddLFxuICBsb2M/OiBBU1QuU291cmNlTG9jYXRpb25cbik6IEFTVC5BdHRyTm9kZSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ0F0dHJOb2RlJyxcbiAgICBuYW1lOiBuYW1lLFxuICAgIHZhbHVlOiB2YWx1ZSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRUZXh0KGNoYXJzPzogc3RyaW5nLCBsb2M/OiBBU1QuU291cmNlTG9jYXRpb24pOiBBU1QuVGV4dE5vZGUge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdUZXh0Tm9kZScsXG4gICAgY2hhcnM6IGNoYXJzIHx8ICcnLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG4vLyBFeHByZXNzaW9uc1xuXG5mdW5jdGlvbiBidWlsZFNleHByKFxuICBwYXRoOiBCdWlsZGVySGVhZCxcbiAgcGFyYW1zPzogQVNULkV4cHJlc3Npb25bXSxcbiAgaGFzaD86IEFTVC5IYXNoLFxuICBsb2M/OiBBU1QuU291cmNlTG9jYXRpb25cbik6IEFTVC5TdWJFeHByZXNzaW9uIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnU3ViRXhwcmVzc2lvbicsXG4gICAgcGF0aDogYnVpbGRIZWFkKHBhdGgpLFxuICAgIHBhcmFtczogcGFyYW1zIHx8IFtdLFxuICAgIGhhc2g6IGhhc2ggfHwgYnVpbGRIYXNoKFtdKSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRIZWFkKG9yaWdpbmFsOiBCdWlsZGVySGVhZCwgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uKTogQVNULkV4cHJlc3Npb24ge1xuICBpZiAodHlwZW9mIG9yaWdpbmFsICE9PSAnc3RyaW5nJykgcmV0dXJuIG9yaWdpbmFsO1xuXG4gIGxldCBwYXJ0cyA9IG9yaWdpbmFsLnNwbGl0KCcuJyk7XG4gIGxldCB0aGlzSGVhZCA9IGZhbHNlO1xuXG4gIGlmIChwYXJ0c1swXSA9PT0gJ3RoaXMnKSB7XG4gICAgdGhpc0hlYWQgPSB0cnVlO1xuICAgIHBhcnRzID0gcGFydHMuc2xpY2UoMSk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHR5cGU6ICdQYXRoRXhwcmVzc2lvbicsXG4gICAgb3JpZ2luYWwsXG4gICAgdGhpczogdGhpc0hlYWQsXG4gICAgcGFydHMsXG4gICAgZGF0YTogZmFsc2UsXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH07XG59XG5cbmZ1bmN0aW9uIGJ1aWxkTGl0ZXJhbDxUIGV4dGVuZHMgQVNULkxpdGVyYWw+KFxuICB0eXBlOiBUWyd0eXBlJ10sXG4gIHZhbHVlOiBUWyd2YWx1ZSddLFxuICBsb2M/OiBBU1QuU291cmNlTG9jYXRpb25cbik6IFQge1xuICByZXR1cm4ge1xuICAgIHR5cGUsXG4gICAgdmFsdWUsXG4gICAgb3JpZ2luYWw6IHZhbHVlLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9IGFzIFQ7XG59XG5cbi8vIE1pc2NlbGxhbmVvdXNcblxuZnVuY3Rpb24gYnVpbGRIYXNoKHBhaXJzPzogQVNULkhhc2hQYWlyW10sIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvbik6IEFTVC5IYXNoIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnSGFzaCcsXG4gICAgcGFpcnM6IHBhaXJzIHx8IFtdLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZFBhaXIoa2V5OiBzdHJpbmcsIHZhbHVlOiBBU1QuRXhwcmVzc2lvbiwgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uKTogQVNULkhhc2hQYWlyIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnSGFzaFBhaXInLFxuICAgIGtleToga2V5LFxuICAgIHZhbHVlLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZFByb2dyYW0oXG4gIGJvZHk/OiBBU1QuU3RhdGVtZW50W10sXG4gIGJsb2NrUGFyYW1zPzogc3RyaW5nW10sXG4gIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvblxuKTogQVNULlRlbXBsYXRlIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnVGVtcGxhdGUnLFxuICAgIGJvZHk6IGJvZHkgfHwgW10sXG4gICAgYmxvY2tQYXJhbXM6IGJsb2NrUGFyYW1zIHx8IFtdLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZEJsb2NrSXRzZWxmKFxuICBib2R5PzogQVNULlN0YXRlbWVudFtdLFxuICBibG9ja1BhcmFtcz86IHN0cmluZ1tdLFxuICBjaGFpbmVkID0gZmFsc2UsXG4gIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvblxuKTogQVNULkJsb2NrIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnQmxvY2snLFxuICAgIGJvZHk6IGJvZHkgfHwgW10sXG4gICAgYmxvY2tQYXJhbXM6IGJsb2NrUGFyYW1zIHx8IFtdLFxuICAgIGNoYWluZWQsXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH07XG59XG5cbmZ1bmN0aW9uIGJ1aWxkVGVtcGxhdGUoXG4gIGJvZHk/OiBBU1QuU3RhdGVtZW50W10sXG4gIGJsb2NrUGFyYW1zPzogc3RyaW5nW10sXG4gIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvblxuKTogQVNULlRlbXBsYXRlIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnVGVtcGxhdGUnLFxuICAgIGJvZHk6IGJvZHkgfHwgW10sXG4gICAgYmxvY2tQYXJhbXM6IGJsb2NrUGFyYW1zIHx8IFtdLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZFNvdXJjZShzb3VyY2U/OiBzdHJpbmcpIHtcbiAgcmV0dXJuIHNvdXJjZSB8fCBudWxsO1xufVxuXG5mdW5jdGlvbiBidWlsZFBvc2l0aW9uKGxpbmU6IG51bWJlciwgY29sdW1uOiBudW1iZXIpIHtcbiAgcmV0dXJuIHtcbiAgICBsaW5lLFxuICAgIGNvbHVtbixcbiAgfTtcbn1cblxuZXhwb3J0IGNvbnN0IFNZTlRIRVRJQzogQVNULlNvdXJjZUxvY2F0aW9uID0ge1xuICBzb3VyY2U6ICcoc3ludGhldGljKScsXG4gIHN0YXJ0OiB7IGxpbmU6IDEsIGNvbHVtbjogMCB9LFxuICBlbmQ6IHsgbGluZTogMSwgY29sdW1uOiAwIH0sXG59O1xuXG5mdW5jdGlvbiBidWlsZExvYyhsb2M6IE9wdGlvbjxBU1QuU291cmNlTG9jYXRpb24+KTogQVNULlNvdXJjZUxvY2F0aW9uO1xuZnVuY3Rpb24gYnVpbGRMb2MoXG4gIHN0YXJ0TGluZTogbnVtYmVyLFxuICBzdGFydENvbHVtbjogbnVtYmVyLFxuICBlbmRMaW5lPzogbnVtYmVyLFxuICBlbmRDb2x1bW4/OiBudW1iZXIsXG4gIHNvdXJjZT86IHN0cmluZ1xuKTogQVNULlNvdXJjZUxvY2F0aW9uO1xuXG5mdW5jdGlvbiBidWlsZExvYyguLi5hcmdzOiBhbnlbXSk6IEFTVC5Tb3VyY2VMb2NhdGlvbiB7XG4gIGlmIChhcmdzLmxlbmd0aCA9PT0gMSkge1xuICAgIGxldCBsb2MgPSBhcmdzWzBdO1xuXG4gICAgaWYgKGxvYyAmJiB0eXBlb2YgbG9jID09PSAnb2JqZWN0Jykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc291cmNlOiBidWlsZFNvdXJjZShsb2Muc291cmNlKSxcbiAgICAgICAgc3RhcnQ6IGJ1aWxkUG9zaXRpb24obG9jLnN0YXJ0LmxpbmUsIGxvYy5zdGFydC5jb2x1bW4pLFxuICAgICAgICBlbmQ6IGJ1aWxkUG9zaXRpb24obG9jLmVuZC5saW5lLCBsb2MuZW5kLmNvbHVtbiksXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gU1lOVEhFVElDO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBsZXQgW3N0YXJ0TGluZSwgc3RhcnRDb2x1bW4sIGVuZExpbmUsIGVuZENvbHVtbiwgc291cmNlXSA9IGFyZ3M7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNvdXJjZTogYnVpbGRTb3VyY2Uoc291cmNlKSxcbiAgICAgIHN0YXJ0OiBidWlsZFBvc2l0aW9uKHN0YXJ0TGluZSwgc3RhcnRDb2x1bW4pLFxuICAgICAgZW5kOiBidWlsZFBvc2l0aW9uKGVuZExpbmUsIGVuZENvbHVtbiksXG4gICAgfTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCB7XG4gIG11c3RhY2hlOiBidWlsZE11c3RhY2hlLFxuICBibG9jazogYnVpbGRCbG9jayxcbiAgcGFydGlhbDogYnVpbGRQYXJ0aWFsLFxuICBjb21tZW50OiBidWlsZENvbW1lbnQsXG4gIG11c3RhY2hlQ29tbWVudDogYnVpbGRNdXN0YWNoZUNvbW1lbnQsXG4gIGVsZW1lbnQ6IGJ1aWxkRWxlbWVudCxcbiAgZWxlbWVudE1vZGlmaWVyOiBidWlsZEVsZW1lbnRNb2RpZmllcixcbiAgYXR0cjogYnVpbGRBdHRyLFxuICB0ZXh0OiBidWlsZFRleHQsXG4gIHNleHByOiBidWlsZFNleHByLFxuICBwYXRoOiBidWlsZEhlYWQsXG4gIGNvbmNhdDogYnVpbGRDb25jYXQsXG4gIGhhc2g6IGJ1aWxkSGFzaCxcbiAgcGFpcjogYnVpbGRQYWlyLFxuICBsaXRlcmFsOiBidWlsZExpdGVyYWwsXG4gIHByb2dyYW06IGJ1aWxkUHJvZ3JhbSxcbiAgYmxvY2tJdHNlbGY6IGJ1aWxkQmxvY2tJdHNlbGYsXG4gIHRlbXBsYXRlOiBidWlsZFRlbXBsYXRlLFxuICBsb2M6IGJ1aWxkTG9jLFxuICBwb3M6IGJ1aWxkUG9zaXRpb24sXG5cbiAgc3RyaW5nOiBsaXRlcmFsKCdTdHJpbmdMaXRlcmFsJykgYXMgKHZhbHVlOiBzdHJpbmcpID0+IFN0cmluZ0xpdGVyYWwsXG4gIGJvb2xlYW46IGxpdGVyYWwoJ0Jvb2xlYW5MaXRlcmFsJykgYXMgKHZhbHVlOiBib29sZWFuKSA9PiBCb29sZWFuTGl0ZXJhbCxcbiAgbnVtYmVyOiBsaXRlcmFsKCdOdW1iZXJMaXRlcmFsJykgYXMgKHZhbHVlOiBudW1iZXIpID0+IE51bWJlckxpdGVyYWwsXG4gIHVuZGVmaW5lZCgpIHtcbiAgICByZXR1cm4gYnVpbGRMaXRlcmFsKCdVbmRlZmluZWRMaXRlcmFsJywgdW5kZWZpbmVkKTtcbiAgfSxcbiAgbnVsbCgpIHtcbiAgICByZXR1cm4gYnVpbGRMaXRlcmFsKCdOdWxsTGl0ZXJhbCcsIG51bGwpO1xuICB9LFxufTtcblxudHlwZSBCdWlsZExpdGVyYWw8VCBleHRlbmRzIEFTVC5MaXRlcmFsPiA9ICh2YWx1ZTogVFsndmFsdWUnXSkgPT4gVDtcblxuZnVuY3Rpb24gbGl0ZXJhbDxUIGV4dGVuZHMgQVNULkxpdGVyYWw+KHR5cGU6IFRbJ3R5cGUnXSk6IEJ1aWxkTGl0ZXJhbDxUPiB7XG4gIHJldHVybiBmdW5jdGlvbih2YWx1ZTogVFsndmFsdWUnXSk6IFQge1xuICAgIHJldHVybiBidWlsZExpdGVyYWwodHlwZSwgdmFsdWUpO1xuICB9O1xufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==