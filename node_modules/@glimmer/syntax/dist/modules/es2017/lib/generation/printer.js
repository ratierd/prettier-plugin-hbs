import { voidMap } from '../parser/tokenizer-event-handlers';
import { escapeText, escapeAttrValue } from './util';
const NON_WHITESPACE = /\S/;
export default class Printer {
    constructor(options) {
        this.buffer = '';
        this.options = options;
    }
    /*
      This is used by _all_ methods on this Printer class that add to `this.buffer`,
      it allows consumers of the printer to use alternate string representations for
      a given node.
         The primary use case for this are things like source -> source codemod utilities.
      For example, ember-template-recast attempts to always preserve the original string
      formatting in each AST node if no modifications are made to it.
    */
    handledByOverride(node, ensureLeadingWhitespace = false) {
        if (this.options.override !== undefined) {
            let result = this.options.override(node, this.options);
            if (typeof result === 'string') {
                if (ensureLeadingWhitespace && NON_WHITESPACE.test(result[0])) {
                    result = ` ${result}`;
                }
                this.buffer += result;
                return true;
            }
        }
        return false;
    }
    Node(node) {
        switch (node.type) {
            case 'MustacheStatement':
            case 'BlockStatement':
            case 'PartialStatement':
            case 'MustacheCommentStatement':
            case 'CommentStatement':
            case 'TextNode':
            case 'ElementNode':
            case 'AttrNode':
            case 'Block':
            case 'Template':
                return this.TopLevelStatement(node);
            case 'StringLiteral':
            case 'BooleanLiteral':
            case 'NumberLiteral':
            case 'UndefinedLiteral':
            case 'NullLiteral':
            case 'PathExpression':
            case 'SubExpression':
                return this.Expression(node);
            case 'Program':
                return this.Block(node);
            case 'ConcatStatement':
                // should have an AttrNode parent
                return this.ConcatStatement(node);
            case 'Hash':
                return this.Hash(node);
            case 'HashPair':
                return this.HashPair(node);
            case 'ElementModifierStatement':
                return this.ElementModifierStatement(node);
        }
        return unreachable(node, 'Node');
    }
    Expression(expression) {
        switch (expression.type) {
            case 'StringLiteral':
            case 'BooleanLiteral':
            case 'NumberLiteral':
            case 'UndefinedLiteral':
            case 'NullLiteral':
                return this.Literal(expression);
            case 'PathExpression':
                return this.PathExpression(expression);
            case 'SubExpression':
                return this.SubExpression(expression);
        }
        return unreachable(expression, 'Expression');
    }
    Literal(literal) {
        switch (literal.type) {
            case 'StringLiteral':
                return this.StringLiteral(literal);
            case 'BooleanLiteral':
                return this.BooleanLiteral(literal);
            case 'NumberLiteral':
                return this.NumberLiteral(literal);
            case 'UndefinedLiteral':
                return this.UndefinedLiteral(literal);
            case 'NullLiteral':
                return this.NullLiteral(literal);
        }
        return unreachable(literal, 'Literal');
    }
    TopLevelStatement(statement) {
        switch (statement.type) {
            case 'MustacheStatement':
                return this.MustacheStatement(statement);
            case 'BlockStatement':
                return this.BlockStatement(statement);
            case 'PartialStatement':
                return this.PartialStatement(statement);
            case 'MustacheCommentStatement':
                return this.MustacheCommentStatement(statement);
            case 'CommentStatement':
                return this.CommentStatement(statement);
            case 'TextNode':
                return this.TextNode(statement);
            case 'ElementNode':
                return this.ElementNode(statement);
            case 'Block':
            case 'Template':
                return this.Block(statement);
            case 'AttrNode':
                // should have element
                return this.AttrNode(statement);
        }
        unreachable(statement, 'TopLevelStatement');
    }
    Block(block) {
        /*
          When processing a template like:
               ```hbs
          {{#if whatever}}
            whatever
          {{else if somethingElse}}
            something else
          {{else}}
            fallback
          {{/if}}
          ```
               The AST still _effectively_ looks like:
               ```hbs
          {{#if whatever}}
            whatever
          {{else}}{{#if somethingElse}}
            something else
          {{else}}
            fallback
          {{/if}}{{/if}}
          ```
               The only way we can tell if that is the case is by checking for
          `block.chained`, but unfortunately when the actual statements are
          processed the `block.body[0]` node (which will always be a
          `BlockStatement`) has no clue that its anscestor `Block` node was
          chained.
               This "forwards" the `chained` setting so that we can check
          it later when processing the `BlockStatement`.
        */
        if (block.chained) {
            let firstChild = block.body[0];
            firstChild.chained = true;
        }
        if (this.handledByOverride(block)) {
            return;
        }
        this.TopLevelStatements(block.body);
    }
    TopLevelStatements(statements) {
        statements.forEach(statement => this.TopLevelStatement(statement));
    }
    ElementNode(el) {
        if (this.handledByOverride(el)) {
            return;
        }
        this.OpenElementNode(el);
        this.TopLevelStatements(el.children);
        this.CloseElementNode(el);
    }
    OpenElementNode(el) {
        this.buffer += `<${el.tag}`;
        if (el.attributes.length) {
            el.attributes.forEach(attr => {
                this.buffer += ' ';
                this.AttrNode(attr);
            });
        }
        if (el.modifiers.length) {
            el.modifiers.forEach(mod => {
                this.buffer += ' ';
                this.ElementModifierStatement(mod);
            });
        }
        if (el.comments.length) {
            el.comments.forEach(comment => {
                this.buffer += ' ';
                this.MustacheCommentStatement(comment);
            });
        }
        if (el.blockParams.length) {
            this.BlockParams(el.blockParams);
        }
        if (el.selfClosing) {
            this.buffer += ' /';
        }
        this.buffer += '>';
    }
    CloseElementNode(el) {
        if (el.selfClosing || voidMap[el.tag.toLowerCase()]) {
            return;
        }
        this.buffer += `</${el.tag}>`;
    }
    AttrNode(attr) {
        if (this.handledByOverride(attr)) {
            return;
        }
        let { name, value } = attr;
        this.buffer += name;
        if (value.type !== 'TextNode' || value.chars.length > 0) {
            this.buffer += '=';
            this.AttrNodeValue(value);
        }
    }
    AttrNodeValue(value) {
        if (value.type === 'TextNode') {
            this.buffer += '"';
            this.TextNode(value, true);
            this.buffer += '"';
        } else {
            this.Node(value);
        }
    }
    TextNode(text, isAttr) {
        if (this.handledByOverride(text)) {
            return;
        }
        if (this.options.entityEncoding === 'raw') {
            this.buffer += text.chars;
        } else if (isAttr) {
            this.buffer += escapeAttrValue(text.chars);
        } else {
            this.buffer += escapeText(text.chars);
        }
    }
    MustacheStatement(mustache) {
        if (this.handledByOverride(mustache)) {
            return;
        }
        this.buffer += mustache.escaped ? '{{' : '{{{';
        if (mustache.strip.open) {
            this.buffer += '~';
        }
        this.Expression(mustache.path);
        this.Params(mustache.params);
        this.Hash(mustache.hash);
        if (mustache.strip.close) {
            this.buffer += '~';
        }
        this.buffer += mustache.escaped ? '}}' : '}}}';
    }
    BlockStatement(block) {
        if (this.handledByOverride(block)) {
            return;
        }
        if (block.chained) {
            this.buffer += block.inverseStrip.open ? '{{~' : '{{';
            this.buffer += 'else ';
        } else {
            this.buffer += block.openStrip.open ? '{{~#' : '{{#';
        }
        this.Expression(block.path);
        this.Params(block.params);
        this.Hash(block.hash);
        if (block.program.blockParams.length) {
            this.BlockParams(block.program.blockParams);
        }
        if (block.chained) {
            this.buffer += block.inverseStrip.close ? '~}}' : '}}';
        } else {
            this.buffer += block.openStrip.close ? '~}}' : '}}';
        }
        this.Block(block.program);
        if (block.inverse) {
            if (!block.inverse.chained) {
                this.buffer += block.inverseStrip.open ? '{{~' : '{{';
                this.buffer += 'else';
                this.buffer += block.inverseStrip.close ? '~}}' : '}}';
            }
            this.Block(block.inverse);
        }
        if (!block.chained) {
            this.buffer += block.closeStrip.open ? '{{~/' : '{{/';
            this.Expression(block.path);
            this.buffer += block.closeStrip.close ? '~}}' : '}}';
        }
    }
    BlockParams(blockParams) {
        this.buffer += ` as |${blockParams.join(' ')}|`;
    }
    PartialStatement(partial) {
        if (this.handledByOverride(partial)) {
            return;
        }
        this.buffer += '{{>';
        this.Expression(partial.name);
        this.Params(partial.params);
        this.Hash(partial.hash);
        this.buffer += '}}';
    }
    ConcatStatement(concat) {
        if (this.handledByOverride(concat)) {
            return;
        }
        this.buffer += '"';
        concat.parts.forEach(part => {
            if (part.type === 'TextNode') {
                this.TextNode(part, true);
            } else {
                this.Node(part);
            }
        });
        this.buffer += '"';
    }
    MustacheCommentStatement(comment) {
        if (this.handledByOverride(comment)) {
            return;
        }
        this.buffer += `{{!--${comment.value}--}}`;
    }
    ElementModifierStatement(mod) {
        if (this.handledByOverride(mod)) {
            return;
        }
        this.buffer += '{{';
        this.Expression(mod.path);
        this.Params(mod.params);
        this.Hash(mod.hash);
        this.buffer += '}}';
    }
    CommentStatement(comment) {
        if (this.handledByOverride(comment)) {
            return;
        }
        this.buffer += `<!--${comment.value}-->`;
    }
    PathExpression(path) {
        if (this.handledByOverride(path)) {
            return;
        }
        this.buffer += path.original;
    }
    SubExpression(sexp) {
        if (this.handledByOverride(sexp)) {
            return;
        }
        this.buffer += '(';
        this.Expression(sexp.path);
        this.Params(sexp.params);
        this.Hash(sexp.hash);
        this.buffer += ')';
    }
    Params(params) {
        // TODO: implement a top level Params AST node (just like the Hash object)
        // so that this can also be overridden
        if (params.length) {
            params.forEach(param => {
                this.buffer += ' ';
                this.Expression(param);
            });
        }
    }
    Hash(hash) {
        if (this.handledByOverride(hash, true)) {
            return;
        }
        hash.pairs.forEach(pair => {
            this.buffer += ' ';
            this.HashPair(pair);
        });
    }
    HashPair(pair) {
        if (this.handledByOverride(pair)) {
            return;
        }
        this.buffer += pair.key;
        this.buffer += '=';
        this.Node(pair.value);
    }
    StringLiteral(str) {
        if (this.handledByOverride(str)) {
            return;
        }
        this.buffer += JSON.stringify(str.value);
    }
    BooleanLiteral(bool) {
        if (this.handledByOverride(bool)) {
            return;
        }
        this.buffer += bool.value;
    }
    NumberLiteral(number) {
        if (this.handledByOverride(number)) {
            return;
        }
        this.buffer += number.value;
    }
    UndefinedLiteral(node) {
        if (this.handledByOverride(node)) {
            return;
        }
        this.buffer += 'undefined';
    }
    NullLiteral(node) {
        if (this.handledByOverride(node)) {
            return;
        }
        this.buffer += 'null';
    }
    print(node) {
        let { options } = this;
        if (options.override) {
            let result = options.override(node, options);
            if (result !== undefined) {
                return result;
            }
        }
        this.buffer = '';
        this.Node(node);
        return this.buffer;
    }
}
function unreachable(node, parentNodeType) {
    let { loc, type } = node;
    throw new Error(`Non-exhaustive node narrowing ${type} @ location: ${JSON.stringify(loc)} for parent ${parentNodeType}`);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL3N5bnRheC9saWIvZ2VuZXJhdGlvbi9wcmludGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQTRCQSxTQUFTLE9BQVQsUUFBd0Isb0NBQXhCO0FBQ0EsU0FBUyxVQUFULEVBQXFCLGVBQXJCLFFBQTRDLFFBQTVDO0FBRUEsTUFBTSxpQkFBaUIsSUFBdkI7QUFzQkEsZUFBYyxNQUFPLE9BQVAsQ0FBYztBQUkxQixnQkFBWSxPQUFaLEVBQW1DO0FBSDNCLGFBQUEsTUFBQSxHQUFTLEVBQVQ7QUFJTixhQUFLLE9BQUwsR0FBZSxPQUFmO0FBQ0Q7QUFFRDs7Ozs7Ozs7QUFTQSxzQkFBa0IsSUFBbEIsRUFBOEIsMEJBQTBCLEtBQXhELEVBQTZEO0FBQzNELFlBQUksS0FBSyxPQUFMLENBQWEsUUFBYixLQUEwQixTQUE5QixFQUF5QztBQUN2QyxnQkFBSSxTQUFTLEtBQUssT0FBTCxDQUFhLFFBQWIsQ0FBc0IsSUFBdEIsRUFBNEIsS0FBSyxPQUFqQyxDQUFiO0FBQ0EsZ0JBQUksT0FBTyxNQUFQLEtBQWtCLFFBQXRCLEVBQWdDO0FBQzlCLG9CQUFJLDJCQUEyQixlQUFlLElBQWYsQ0FBb0IsT0FBTyxDQUFQLENBQXBCLENBQS9CLEVBQStEO0FBQzdELDZCQUFTLElBQUksTUFBTSxFQUFuQjtBQUNEO0FBRUQscUJBQUssTUFBTCxJQUFlLE1BQWY7QUFDQSx1QkFBTyxJQUFQO0FBQ0Q7QUFDRjtBQUVELGVBQU8sS0FBUDtBQUNEO0FBRUQsU0FBSyxJQUFMLEVBQWU7QUFDYixnQkFBUSxLQUFLLElBQWI7QUFDRSxpQkFBSyxtQkFBTDtBQUNBLGlCQUFLLGdCQUFMO0FBQ0EsaUJBQUssa0JBQUw7QUFDQSxpQkFBSywwQkFBTDtBQUNBLGlCQUFLLGtCQUFMO0FBQ0EsaUJBQUssVUFBTDtBQUNBLGlCQUFLLGFBQUw7QUFDQSxpQkFBSyxVQUFMO0FBQ0EsaUJBQUssT0FBTDtBQUNBLGlCQUFLLFVBQUw7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QSxZQUFJLFFBQVEsUUFBWixFQUFzQjtBQUNwQixnQkFBSSxTQUFTLFFBQVEsUUFBUixDQUFpQixJQUFqQixFQUF1QixPQUF2QixDQUFiO0FBRUEsZ0JBQUksV0FBVyxTQUFmLEVBQTBCO0FBQ3hCLHVCQUFPLE1BQVA7QUFDRDtBQUNGO0FBRUQsYUFBSyxNQUFMLEdBQWMsRUFBZDtBQUNBLGFBQUssSUFBTCxDQUFVLElBQVY7QUFDQSxlQUFPLEtBQUssTUFBWjtBQUNEO0FBL2V5QjtBQWtmNUIsU0FBUyxXQUFULENBQXFCLElBQXJCLEVBQWtDLGNBQWxDLEVBQXdEO0FBQ3RELFFBQUksRUFBRSxHQUFGLEVBQU8sSUFBUCxLQUFpQixJQUFyQjtBQUNBLFVBQU0sSUFBSSxLQUFKLENBQ0osaUNBQWlDLElBQUksZ0JBQWdCLEtBQUssU0FBTCxDQUNuRCxHQURtRCxDQUVwRCxlQUFlLGNBQWMsRUFIMUIsQ0FBTjtBQUtEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQXR0ck5vZGUsXG4gIEJsb2NrLFxuICBCbG9ja1N0YXRlbWVudCxcbiAgRWxlbWVudE5vZGUsXG4gIE11c3RhY2hlU3RhdGVtZW50LFxuICBOb2RlLFxuICBQcm9ncmFtLFxuICBUZXh0Tm9kZSxcbiAgUGFydGlhbFN0YXRlbWVudCxcbiAgQ29uY2F0U3RhdGVtZW50LFxuICBNdXN0YWNoZUNvbW1lbnRTdGF0ZW1lbnQsXG4gIENvbW1lbnRTdGF0ZW1lbnQsXG4gIEVsZW1lbnRNb2RpZmllclN0YXRlbWVudCxcbiAgRXhwcmVzc2lvbixcbiAgUGF0aEV4cHJlc3Npb24sXG4gIFN1YkV4cHJlc3Npb24sXG4gIEhhc2gsXG4gIEhhc2hQYWlyLFxuICBMaXRlcmFsLFxuICBTdHJpbmdMaXRlcmFsLFxuICBCb29sZWFuTGl0ZXJhbCxcbiAgTnVtYmVyTGl0ZXJhbCxcbiAgVW5kZWZpbmVkTGl0ZXJhbCxcbiAgTnVsbExpdGVyYWwsXG4gIFRvcExldmVsU3RhdGVtZW50LFxuICBUZW1wbGF0ZSxcbn0gZnJvbSAnLi4vdHlwZXMvbm9kZXMnO1xuaW1wb3J0IHsgdm9pZE1hcCB9IGZyb20gJy4uL3BhcnNlci90b2tlbml6ZXItZXZlbnQtaGFuZGxlcnMnO1xuaW1wb3J0IHsgZXNjYXBlVGV4dCwgZXNjYXBlQXR0clZhbHVlIH0gZnJvbSAnLi91dGlsJztcblxuY29uc3QgTk9OX1dISVRFU1BBQ0UgPSAvXFxTLztcblxuZXhwb3J0IGludGVyZmFjZSBQcmludGVyT3B0aW9ucyB7XG4gIGVudGl0eUVuY29kaW5nOiAndHJhbnNmb3JtZWQnIHwgJ3Jhdyc7XG5cbiAgLyoqXG4gICAqIFVzZWQgdG8gb3ZlcnJpZGUgdGhlIG1lY2hhbmlzbSBvZiBwcmludGluZyBhIGdpdmVuIEFTVC5Ob2RlLlxuICAgKlxuICAgKiBUaGlzIHdpbGwgZ2VuZXJhbGx5IG9ubHkgYmUgdXNlZnVsIHRvIHNvdXJjZSAtPiBzb3VyY2UgY29kZW1vZHNcbiAgICogd2hlcmUgeW91IHdvdWxkIGxpa2UgdG8gc3BlY2lhbGl6ZS9vdmVycmlkZSB0aGUgd2F5IGEgZ2l2ZW4gbm9kZSBpc1xuICAgKiBwcmludGVkIChlLmcuIHlvdSB3b3VsZCBsaWtlIHRvIHByZXNlcnZlIGFzIG11Y2ggb2YgdGhlIG9yaWdpbmFsXG4gICAqIGZvcm1hdHRpbmcgYXMgcG9zc2libGUpLlxuICAgKlxuICAgKiBXaGVuIHRoZSBwcm92aWRlZCBvdmVycmlkZSByZXR1cm5zIHVuZGVmaW5lZCwgdGhlIGRlZmF1bHQgYnVpbHQgaW4gcHJpbnRpbmdcbiAgICogd2lsbCBiZSBkb25lIGZvciB0aGUgQVNULk5vZGUuXG4gICAqXG4gICAqIEBwYXJhbSBhc3QgdGhlIGFzdCBub2RlIHRvIGJlIHByaW50ZWRcbiAgICogQHBhcmFtIG9wdGlvbnMgdGhlIG9wdGlvbnMgc3BlY2lmaWVkIGR1cmluZyB0aGUgcHJpbnQoKSBpbnZvY2F0aW9uXG4gICAqL1xuICBvdmVycmlkZT8oYXN0OiBOb2RlLCBvcHRpb25zOiBQcmludGVyT3B0aW9ucyk6IHZvaWQgfCBzdHJpbmc7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFByaW50ZXIge1xuICBwcml2YXRlIGJ1ZmZlciA9ICcnO1xuICBwcml2YXRlIG9wdGlvbnM6IFByaW50ZXJPcHRpb25zO1xuXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnM6IFByaW50ZXJPcHRpb25zKSB7XG4gICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgfVxuXG4gIC8qXG4gICAgVGhpcyBpcyB1c2VkIGJ5IF9hbGxfIG1ldGhvZHMgb24gdGhpcyBQcmludGVyIGNsYXNzIHRoYXQgYWRkIHRvIGB0aGlzLmJ1ZmZlcmAsXG4gICAgaXQgYWxsb3dzIGNvbnN1bWVycyBvZiB0aGUgcHJpbnRlciB0byB1c2UgYWx0ZXJuYXRlIHN0cmluZyByZXByZXNlbnRhdGlvbnMgZm9yXG4gICAgYSBnaXZlbiBub2RlLlxuXG4gICAgVGhlIHByaW1hcnkgdXNlIGNhc2UgZm9yIHRoaXMgYXJlIHRoaW5ncyBsaWtlIHNvdXJjZSAtPiBzb3VyY2UgY29kZW1vZCB1dGlsaXRpZXMuXG4gICAgRm9yIGV4YW1wbGUsIGVtYmVyLXRlbXBsYXRlLXJlY2FzdCBhdHRlbXB0cyB0byBhbHdheXMgcHJlc2VydmUgdGhlIG9yaWdpbmFsIHN0cmluZ1xuICAgIGZvcm1hdHRpbmcgaW4gZWFjaCBBU1Qgbm9kZSBpZiBubyBtb2RpZmljYXRpb25zIGFyZSBtYWRlIHRvIGl0LlxuICAqL1xuICBoYW5kbGVkQnlPdmVycmlkZShub2RlOiBOb2RlLCBlbnN1cmVMZWFkaW5nV2hpdGVzcGFjZSA9IGZhbHNlKTogYm9vbGVhbiB7XG4gICAgaWYgKHRoaXMub3B0aW9ucy5vdmVycmlkZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBsZXQgcmVzdWx0ID0gdGhpcy5vcHRpb25zLm92ZXJyaWRlKG5vZGUsIHRoaXMub3B0aW9ucyk7XG4gICAgICBpZiAodHlwZW9mIHJlc3VsdCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgaWYgKGVuc3VyZUxlYWRpbmdXaGl0ZXNwYWNlICYmIE5PTl9XSElURVNQQUNFLnRlc3QocmVzdWx0WzBdKSkge1xuICAgICAgICAgIHJlc3VsdCA9IGAgJHtyZXN1bHR9YDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuYnVmZmVyICs9IHJlc3VsdDtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgTm9kZShub2RlOiBOb2RlKTogdm9pZCB7XG4gICAgc3dpdGNoIChub2RlLnR5cGUpIHtcbiAgICAgIGNhc2UgJ011c3RhY2hlU3RhdGVtZW50JzpcbiAgICAgIGNhc2UgJ0Jsb2NrU3RhdGVtZW50JzpcbiAgICAgIGNhc2UgJ1BhcnRpYWxTdGF0ZW1lbnQnOlxuICAgICAgY2FzZSAnTXVzdGFjaGVDb21tZW50U3RhdGVtZW50JzpcbiAgICAgIGNhc2UgJ0NvbW1lbnRTdGF0ZW1lbnQnOlxuICAgICAgY2FzZSAnVGV4dE5vZGUnOlxuICAgICAgY2FzZSAnRWxlbWVudE5vZGUnOlxuICAgICAgY2FzZSAnQXR0ck5vZGUnOlxuICAgICAgY2FzZSAnQmxvY2snOlxuICAgICAgY2FzZSAnVGVtcGxhdGUnOlxuICAgICAgICByZXR1cm4gdGhpcy5Ub3BMZXZlbFN0YXRlbWVudChub2RlKTtcbiAgICAgIGNhc2UgJ1N0cmluZ0xpdGVyYWwnOlxuICAgICAgY2FzZSAnQm9vbGVhbkxpdGVyYWwnOlxuICAgICAgY2FzZSAnTnVtYmVyTGl0ZXJhbCc6XG4gICAgICBjYXNlICdVbmRlZmluZWRMaXRlcmFsJzpcbiAgICAgIGNhc2UgJ051bGxMaXRlcmFsJzpcbiAgICAgIGNhc2UgJ1BhdGhFeHByZXNzaW9uJzpcbiAgICAgIGNhc2UgJ1N1YkV4cHJlc3Npb24nOlxuICAgICAgICByZXR1cm4gdGhpcy5FeHByZXNzaW9uKG5vZGUpO1xuICAgICAgY2FzZSAnUHJvZ3JhbSc6XG4gICAgICAgIHJldHVybiB0aGlzLkJsb2NrKG5vZGUpO1xuICAgICAgY2FzZSAnQ29uY2F0U3RhdGVtZW50JzpcbiAgICAgICAgLy8gc2hvdWxkIGhhdmUgYW4gQXR0ck5vZGUgcGFyZW50XG4gICAgICAgIHJldHVybiB0aGlzLkNvbmNhdFN0YXRlbWVudChub2RlKTtcbiAgICAgIGNhc2UgJ0hhc2gnOlxuICAgICAgICByZXR1cm4gdGhpcy5IYXNoKG5vZGUpO1xuICAgICAgY2FzZSAnSGFzaFBhaXInOlxuICAgICAgICByZXR1cm4gdGhpcy5IYXNoUGFpcihub2RlKTtcbiAgICAgIGNhc2UgJ0VsZW1lbnRNb2RpZmllclN0YXRlbWVudCc6XG4gICAgICAgIHJldHVybiB0aGlzLkVsZW1lbnRNb2RpZmllclN0YXRlbWVudChub2RlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdW5yZWFjaGFibGUobm9kZSwgJ05vZGUnKTtcbiAgfVxuXG4gIEV4cHJlc3Npb24oZXhwcmVzc2lvbjogRXhwcmVzc2lvbik6IHZvaWQge1xuICAgIHN3aXRjaCAoZXhwcmVzc2lvbi50eXBlKSB7XG4gICAgICBjYXNlICdTdHJpbmdMaXRlcmFsJzpcbiAgICAgIGNhc2UgJ0Jvb2xlYW5MaXRlcmFsJzpcbiAgICAgIGNhc2UgJ051bWJlckxpdGVyYWwnOlxuICAgICAgY2FzZSAnVW5kZWZpbmVkTGl0ZXJhbCc6XG4gICAgICBjYXNlICdOdWxsTGl0ZXJhbCc6XG4gICAgICAgIHJldHVybiB0aGlzLkxpdGVyYWwoZXhwcmVzc2lvbik7XG4gICAgICBjYXNlICdQYXRoRXhwcmVzc2lvbic6XG4gICAgICAgIHJldHVybiB0aGlzLlBhdGhFeHByZXNzaW9uKGV4cHJlc3Npb24pO1xuICAgICAgY2FzZSAnU3ViRXhwcmVzc2lvbic6XG4gICAgICAgIHJldHVybiB0aGlzLlN1YkV4cHJlc3Npb24oZXhwcmVzc2lvbik7XG4gICAgfVxuICAgIHJldHVybiB1bnJlYWNoYWJsZShleHByZXNzaW9uLCAnRXhwcmVzc2lvbicpO1xuICB9XG5cbiAgTGl0ZXJhbChsaXRlcmFsOiBMaXRlcmFsKSB7XG4gICAgc3dpdGNoIChsaXRlcmFsLnR5cGUpIHtcbiAgICAgIGNhc2UgJ1N0cmluZ0xpdGVyYWwnOlxuICAgICAgICByZXR1cm4gdGhpcy5TdHJpbmdMaXRlcmFsKGxpdGVyYWwpO1xuICAgICAgY2FzZSAnQm9vbGVhbkxpdGVyYWwnOlxuICAgICAgICByZXR1cm4gdGhpcy5Cb29sZWFuTGl0ZXJhbChsaXRlcmFsKTtcbiAgICAgIGNhc2UgJ051bWJlckxpdGVyYWwnOlxuICAgICAgICByZXR1cm4gdGhpcy5OdW1iZXJMaXRlcmFsKGxpdGVyYWwpO1xuICAgICAgY2FzZSAnVW5kZWZpbmVkTGl0ZXJhbCc6XG4gICAgICAgIHJldHVybiB0aGlzLlVuZGVmaW5lZExpdGVyYWwobGl0ZXJhbCk7XG4gICAgICBjYXNlICdOdWxsTGl0ZXJhbCc6XG4gICAgICAgIHJldHVybiB0aGlzLk51bGxMaXRlcmFsKGxpdGVyYWwpO1xuICAgIH1cbiAgICByZXR1cm4gdW5yZWFjaGFibGUobGl0ZXJhbCwgJ0xpdGVyYWwnKTtcbiAgfVxuXG4gIFRvcExldmVsU3RhdGVtZW50KHN0YXRlbWVudDogVG9wTGV2ZWxTdGF0ZW1lbnQpIHtcbiAgICBzd2l0Y2ggKHN0YXRlbWVudC50eXBlKSB7XG4gICAgICBjYXNlICdNdXN0YWNoZVN0YXRlbWVudCc6XG4gICAgICAgIHJldHVybiB0aGlzLk11c3RhY2hlU3RhdGVtZW50KHN0YXRlbWVudCk7XG4gICAgICBjYXNlICdCbG9ja1N0YXRlbWVudCc6XG4gICAgICAgIHJldHVybiB0aGlzLkJsb2NrU3RhdGVtZW50KHN0YXRlbWVudCk7XG4gICAgICBjYXNlICdQYXJ0aWFsU3RhdGVtZW50JzpcbiAgICAgICAgcmV0dXJuIHRoaXMuUGFydGlhbFN0YXRlbWVudChzdGF0ZW1lbnQpO1xuICAgICAgY2FzZSAnTXVzdGFjaGVDb21tZW50U3RhdGVtZW50JzpcbiAgICAgICAgcmV0dXJuIHRoaXMuTXVzdGFjaGVDb21tZW50U3RhdGVtZW50KHN0YXRlbWVudCk7XG4gICAgICBjYXNlICdDb21tZW50U3RhdGVtZW50JzpcbiAgICAgICAgcmV0dXJuIHRoaXMuQ29tbWVudFN0YXRlbWVudChzdGF0ZW1lbnQpO1xuICAgICAgY2FzZSAnVGV4dE5vZGUnOlxuICAgICAgICByZXR1cm4gdGhpcy5UZXh0Tm9kZShzdGF0ZW1lbnQpO1xuICAgICAgY2FzZSAnRWxlbWVudE5vZGUnOlxuICAgICAgICByZXR1cm4gdGhpcy5FbGVtZW50Tm9kZShzdGF0ZW1lbnQpO1xuICAgICAgY2FzZSAnQmxvY2snOlxuICAgICAgY2FzZSAnVGVtcGxhdGUnOlxuICAgICAgICByZXR1cm4gdGhpcy5CbG9jayhzdGF0ZW1lbnQpO1xuICAgICAgY2FzZSAnQXR0ck5vZGUnOlxuICAgICAgICAvLyBzaG91bGQgaGF2ZSBlbGVtZW50XG4gICAgICAgIHJldHVybiB0aGlzLkF0dHJOb2RlKHN0YXRlbWVudCk7XG4gICAgfVxuICAgIHVucmVhY2hhYmxlKHN0YXRlbWVudCwgJ1RvcExldmVsU3RhdGVtZW50Jyk7XG4gIH1cblxuICBCbG9jayhibG9jazogQmxvY2sgfCBQcm9ncmFtIHwgVGVtcGxhdGUpOiB2b2lkIHtcbiAgICAvKlxuICAgICAgV2hlbiBwcm9jZXNzaW5nIGEgdGVtcGxhdGUgbGlrZTpcblxuICAgICAgYGBgaGJzXG4gICAgICB7eyNpZiB3aGF0ZXZlcn19XG4gICAgICAgIHdoYXRldmVyXG4gICAgICB7e2Vsc2UgaWYgc29tZXRoaW5nRWxzZX19XG4gICAgICAgIHNvbWV0aGluZyBlbHNlXG4gICAgICB7e2Vsc2V9fVxuICAgICAgICBmYWxsYmFja1xuICAgICAge3svaWZ9fVxuICAgICAgYGBgXG5cbiAgICAgIFRoZSBBU1Qgc3RpbGwgX2VmZmVjdGl2ZWx5XyBsb29rcyBsaWtlOlxuXG4gICAgICBgYGBoYnNcbiAgICAgIHt7I2lmIHdoYXRldmVyfX1cbiAgICAgICAgd2hhdGV2ZXJcbiAgICAgIHt7ZWxzZX19e3sjaWYgc29tZXRoaW5nRWxzZX19XG4gICAgICAgIHNvbWV0aGluZyBlbHNlXG4gICAgICB7e2Vsc2V9fVxuICAgICAgICBmYWxsYmFja1xuICAgICAge3svaWZ9fXt7L2lmfX1cbiAgICAgIGBgYFxuXG4gICAgICBUaGUgb25seSB3YXkgd2UgY2FuIHRlbGwgaWYgdGhhdCBpcyB0aGUgY2FzZSBpcyBieSBjaGVja2luZyBmb3JcbiAgICAgIGBibG9jay5jaGFpbmVkYCwgYnV0IHVuZm9ydHVuYXRlbHkgd2hlbiB0aGUgYWN0dWFsIHN0YXRlbWVudHMgYXJlXG4gICAgICBwcm9jZXNzZWQgdGhlIGBibG9jay5ib2R5WzBdYCBub2RlICh3aGljaCB3aWxsIGFsd2F5cyBiZSBhXG4gICAgICBgQmxvY2tTdGF0ZW1lbnRgKSBoYXMgbm8gY2x1ZSB0aGF0IGl0cyBhbnNjZXN0b3IgYEJsb2NrYCBub2RlIHdhc1xuICAgICAgY2hhaW5lZC5cblxuICAgICAgVGhpcyBcImZvcndhcmRzXCIgdGhlIGBjaGFpbmVkYCBzZXR0aW5nIHNvIHRoYXQgd2UgY2FuIGNoZWNrXG4gICAgICBpdCBsYXRlciB3aGVuIHByb2Nlc3NpbmcgdGhlIGBCbG9ja1N0YXRlbWVudGAuXG4gICAgKi9cbiAgICBpZiAoYmxvY2suY2hhaW5lZCkge1xuICAgICAgbGV0IGZpcnN0Q2hpbGQgPSBibG9jay5ib2R5WzBdIGFzIEJsb2NrU3RhdGVtZW50O1xuICAgICAgZmlyc3RDaGlsZC5jaGFpbmVkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5oYW5kbGVkQnlPdmVycmlkZShibG9jaykpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLlRvcExldmVsU3RhdGVtZW50cyhibG9jay5ib2R5KTtcbiAgfVxuXG4gIFRvcExldmVsU3RhdGVtZW50cyhzdGF0ZW1lbnRzOiBUb3BMZXZlbFN0YXRlbWVudFtdKSB7XG4gICAgc3RhdGVtZW50cy5mb3JFYWNoKHN0YXRlbWVudCA9PiB0aGlzLlRvcExldmVsU3RhdGVtZW50KHN0YXRlbWVudCkpO1xuICB9XG5cbiAgRWxlbWVudE5vZGUoZWw6IEVsZW1lbnROb2RlKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaGFuZGxlZEJ5T3ZlcnJpZGUoZWwpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5PcGVuRWxlbWVudE5vZGUoZWwpO1xuICAgIHRoaXMuVG9wTGV2ZWxTdGF0ZW1lbnRzKGVsLmNoaWxkcmVuKTtcbiAgICB0aGlzLkNsb3NlRWxlbWVudE5vZGUoZWwpO1xuICB9XG5cbiAgT3BlbkVsZW1lbnROb2RlKGVsOiBFbGVtZW50Tm9kZSk6IHZvaWQge1xuICAgIHRoaXMuYnVmZmVyICs9IGA8JHtlbC50YWd9YDtcbiAgICBpZiAoZWwuYXR0cmlidXRlcy5sZW5ndGgpIHtcbiAgICAgIGVsLmF0dHJpYnV0ZXMuZm9yRWFjaChhdHRyID0+IHtcbiAgICAgICAgdGhpcy5idWZmZXIgKz0gJyAnO1xuICAgICAgICB0aGlzLkF0dHJOb2RlKGF0dHIpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChlbC5tb2RpZmllcnMubGVuZ3RoKSB7XG4gICAgICBlbC5tb2RpZmllcnMuZm9yRWFjaChtb2QgPT4ge1xuICAgICAgICB0aGlzLmJ1ZmZlciArPSAnICc7XG4gICAgICAgIHRoaXMuRWxlbWVudE1vZGlmaWVyU3RhdGVtZW50KG1vZCk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGVsLmNvbW1lbnRzLmxlbmd0aCkge1xuICAgICAgZWwuY29tbWVudHMuZm9yRWFjaChjb21tZW50ID0+IHtcbiAgICAgICAgdGhpcy5idWZmZXIgKz0gJyAnO1xuICAgICAgICB0aGlzLk11c3RhY2hlQ29tbWVudFN0YXRlbWVudChjb21tZW50KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoZWwuYmxvY2tQYXJhbXMubGVuZ3RoKSB7XG4gICAgICB0aGlzLkJsb2NrUGFyYW1zKGVsLmJsb2NrUGFyYW1zKTtcbiAgICB9XG4gICAgaWYgKGVsLnNlbGZDbG9zaW5nKSB7XG4gICAgICB0aGlzLmJ1ZmZlciArPSAnIC8nO1xuICAgIH1cbiAgICB0aGlzLmJ1ZmZlciArPSAnPic7XG4gIH1cblxuICBDbG9zZUVsZW1lbnROb2RlKGVsOiBFbGVtZW50Tm9kZSk6IHZvaWQge1xuICAgIGlmIChlbC5zZWxmQ2xvc2luZyB8fCB2b2lkTWFwW2VsLnRhZy50b0xvd2VyQ2FzZSgpXSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmJ1ZmZlciArPSBgPC8ke2VsLnRhZ30+YDtcbiAgfVxuXG4gIEF0dHJOb2RlKGF0dHI6IEF0dHJOb2RlKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaGFuZGxlZEJ5T3ZlcnJpZGUoYXR0cikpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgeyBuYW1lLCB2YWx1ZSB9ID0gYXR0cjtcblxuICAgIHRoaXMuYnVmZmVyICs9IG5hbWU7XG4gICAgaWYgKHZhbHVlLnR5cGUgIT09ICdUZXh0Tm9kZScgfHwgdmFsdWUuY2hhcnMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5idWZmZXIgKz0gJz0nO1xuICAgICAgdGhpcy5BdHRyTm9kZVZhbHVlKHZhbHVlKTtcbiAgICB9XG4gIH1cblxuICBBdHRyTm9kZVZhbHVlKHZhbHVlOiBBdHRyTm9kZVsndmFsdWUnXSkge1xuICAgIGlmICh2YWx1ZS50eXBlID09PSAnVGV4dE5vZGUnKSB7XG4gICAgICB0aGlzLmJ1ZmZlciArPSAnXCInO1xuICAgICAgdGhpcy5UZXh0Tm9kZSh2YWx1ZSwgdHJ1ZSk7XG4gICAgICB0aGlzLmJ1ZmZlciArPSAnXCInO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLk5vZGUodmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIFRleHROb2RlKHRleHQ6IFRleHROb2RlLCBpc0F0dHI/OiBib29sZWFuKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaGFuZGxlZEJ5T3ZlcnJpZGUodGV4dCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5vcHRpb25zLmVudGl0eUVuY29kaW5nID09PSAncmF3Jykge1xuICAgICAgdGhpcy5idWZmZXIgKz0gdGV4dC5jaGFycztcbiAgICB9IGVsc2UgaWYgKGlzQXR0cikge1xuICAgICAgdGhpcy5idWZmZXIgKz0gZXNjYXBlQXR0clZhbHVlKHRleHQuY2hhcnMpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmJ1ZmZlciArPSBlc2NhcGVUZXh0KHRleHQuY2hhcnMpO1xuICAgIH1cbiAgfVxuXG4gIE11c3RhY2hlU3RhdGVtZW50KG11c3RhY2hlOiBNdXN0YWNoZVN0YXRlbWVudCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmhhbmRsZWRCeU92ZXJyaWRlKG11c3RhY2hlKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuYnVmZmVyICs9IG11c3RhY2hlLmVzY2FwZWQgPyAne3snIDogJ3t7eyc7XG5cbiAgICBpZiAobXVzdGFjaGUuc3RyaXAub3Blbikge1xuICAgICAgdGhpcy5idWZmZXIgKz0gJ34nO1xuICAgIH1cblxuICAgIHRoaXMuRXhwcmVzc2lvbihtdXN0YWNoZS5wYXRoKTtcbiAgICB0aGlzLlBhcmFtcyhtdXN0YWNoZS5wYXJhbXMpO1xuICAgIHRoaXMuSGFzaChtdXN0YWNoZS5oYXNoKTtcblxuICAgIGlmIChtdXN0YWNoZS5zdHJpcC5jbG9zZSkge1xuICAgICAgdGhpcy5idWZmZXIgKz0gJ34nO1xuICAgIH1cblxuICAgIHRoaXMuYnVmZmVyICs9IG11c3RhY2hlLmVzY2FwZWQgPyAnfX0nIDogJ319fSc7XG4gIH1cblxuICBCbG9ja1N0YXRlbWVudChibG9jazogQmxvY2tTdGF0ZW1lbnQpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5oYW5kbGVkQnlPdmVycmlkZShibG9jaykpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoYmxvY2suY2hhaW5lZCkge1xuICAgICAgdGhpcy5idWZmZXIgKz0gYmxvY2suaW52ZXJzZVN0cmlwLm9wZW4gPyAne3t+JyA6ICd7eyc7XG4gICAgICB0aGlzLmJ1ZmZlciArPSAnZWxzZSAnO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmJ1ZmZlciArPSBibG9jay5vcGVuU3RyaXAub3BlbiA/ICd7e34jJyA6ICd7eyMnO1xuICAgIH1cblxuICAgIHRoaXMuRXhwcmVzc2lvbihibG9jay5wYXRoKTtcbiAgICB0aGlzLlBhcmFtcyhibG9jay5wYXJhbXMpO1xuICAgIHRoaXMuSGFzaChibG9jay5oYXNoKTtcbiAgICBpZiAoYmxvY2sucHJvZ3JhbS5ibG9ja1BhcmFtcy5sZW5ndGgpIHtcbiAgICAgIHRoaXMuQmxvY2tQYXJhbXMoYmxvY2sucHJvZ3JhbS5ibG9ja1BhcmFtcyk7XG4gICAgfVxuXG4gICAgaWYgKGJsb2NrLmNoYWluZWQpIHtcbiAgICAgIHRoaXMuYnVmZmVyICs9IGJsb2NrLmludmVyc2VTdHJpcC5jbG9zZSA/ICd+fX0nIDogJ319JztcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5idWZmZXIgKz0gYmxvY2sub3BlblN0cmlwLmNsb3NlID8gJ359fScgOiAnfX0nO1xuICAgIH1cblxuICAgIHRoaXMuQmxvY2soYmxvY2sucHJvZ3JhbSk7XG5cbiAgICBpZiAoYmxvY2suaW52ZXJzZSkge1xuICAgICAgaWYgKCFibG9jay5pbnZlcnNlLmNoYWluZWQpIHtcbiAgICAgICAgdGhpcy5idWZmZXIgKz0gYmxvY2suaW52ZXJzZVN0cmlwLm9wZW4gPyAne3t+JyA6ICd7eyc7XG4gICAgICAgIHRoaXMuYnVmZmVyICs9ICdlbHNlJztcbiAgICAgICAgdGhpcy5idWZmZXIgKz0gYmxvY2suaW52ZXJzZVN0cmlwLmNsb3NlID8gJ359fScgOiAnfX0nO1xuICAgICAgfVxuXG4gICAgICB0aGlzLkJsb2NrKGJsb2NrLmludmVyc2UpO1xuICAgIH1cblxuICAgIGlmICghYmxvY2suY2hhaW5lZCkge1xuICAgICAgdGhpcy5idWZmZXIgKz0gYmxvY2suY2xvc2VTdHJpcC5vcGVuID8gJ3t7fi8nIDogJ3t7Lyc7XG4gICAgICB0aGlzLkV4cHJlc3Npb24oYmxvY2sucGF0aCk7XG4gICAgICB0aGlzLmJ1ZmZlciArPSBibG9jay5jbG9zZVN0cmlwLmNsb3NlID8gJ359fScgOiAnfX0nO1xuICAgIH1cbiAgfVxuXG4gIEJsb2NrUGFyYW1zKGJsb2NrUGFyYW1zOiBzdHJpbmdbXSkge1xuICAgIHRoaXMuYnVmZmVyICs9IGAgYXMgfCR7YmxvY2tQYXJhbXMuam9pbignICcpfXxgO1xuICB9XG5cbiAgUGFydGlhbFN0YXRlbWVudChwYXJ0aWFsOiBQYXJ0aWFsU3RhdGVtZW50KTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaGFuZGxlZEJ5T3ZlcnJpZGUocGFydGlhbCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmJ1ZmZlciArPSAne3s+JztcbiAgICB0aGlzLkV4cHJlc3Npb24ocGFydGlhbC5uYW1lKTtcbiAgICB0aGlzLlBhcmFtcyhwYXJ0aWFsLnBhcmFtcyk7XG4gICAgdGhpcy5IYXNoKHBhcnRpYWwuaGFzaCk7XG4gICAgdGhpcy5idWZmZXIgKz0gJ319JztcbiAgfVxuXG4gIENvbmNhdFN0YXRlbWVudChjb25jYXQ6IENvbmNhdFN0YXRlbWVudCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmhhbmRsZWRCeU92ZXJyaWRlKGNvbmNhdCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmJ1ZmZlciArPSAnXCInO1xuICAgIGNvbmNhdC5wYXJ0cy5mb3JFYWNoKHBhcnQgPT4ge1xuICAgICAgaWYgKHBhcnQudHlwZSA9PT0gJ1RleHROb2RlJykge1xuICAgICAgICB0aGlzLlRleHROb2RlKHBhcnQsIHRydWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5Ob2RlKHBhcnQpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMuYnVmZmVyICs9ICdcIic7XG4gIH1cblxuICBNdXN0YWNoZUNvbW1lbnRTdGF0ZW1lbnQoY29tbWVudDogTXVzdGFjaGVDb21tZW50U3RhdGVtZW50KTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaGFuZGxlZEJ5T3ZlcnJpZGUoY29tbWVudCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmJ1ZmZlciArPSBge3shLS0ke2NvbW1lbnQudmFsdWV9LS19fWA7XG4gIH1cblxuICBFbGVtZW50TW9kaWZpZXJTdGF0ZW1lbnQobW9kOiBFbGVtZW50TW9kaWZpZXJTdGF0ZW1lbnQpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5oYW5kbGVkQnlPdmVycmlkZShtb2QpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5idWZmZXIgKz0gJ3t7JztcbiAgICB0aGlzLkV4cHJlc3Npb24obW9kLnBhdGgpO1xuICAgIHRoaXMuUGFyYW1zKG1vZC5wYXJhbXMpO1xuICAgIHRoaXMuSGFzaChtb2QuaGFzaCk7XG4gICAgdGhpcy5idWZmZXIgKz0gJ319JztcbiAgfVxuXG4gIENvbW1lbnRTdGF0ZW1lbnQoY29tbWVudDogQ29tbWVudFN0YXRlbWVudCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmhhbmRsZWRCeU92ZXJyaWRlKGNvbW1lbnQpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5idWZmZXIgKz0gYDwhLS0ke2NvbW1lbnQudmFsdWV9LS0+YDtcbiAgfVxuXG4gIFBhdGhFeHByZXNzaW9uKHBhdGg6IFBhdGhFeHByZXNzaW9uKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaGFuZGxlZEJ5T3ZlcnJpZGUocGF0aCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmJ1ZmZlciArPSBwYXRoLm9yaWdpbmFsO1xuICB9XG5cbiAgU3ViRXhwcmVzc2lvbihzZXhwOiBTdWJFeHByZXNzaW9uKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaGFuZGxlZEJ5T3ZlcnJpZGUoc2V4cCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmJ1ZmZlciArPSAnKCc7XG4gICAgdGhpcy5FeHByZXNzaW9uKHNleHAucGF0aCk7XG4gICAgdGhpcy5QYXJhbXMoc2V4cC5wYXJhbXMpO1xuICAgIHRoaXMuSGFzaChzZXhwLmhhc2gpO1xuICAgIHRoaXMuYnVmZmVyICs9ICcpJztcbiAgfVxuXG4gIFBhcmFtcyhwYXJhbXM6IEV4cHJlc3Npb25bXSkge1xuICAgIC8vIFRPRE86IGltcGxlbWVudCBhIHRvcCBsZXZlbCBQYXJhbXMgQVNUIG5vZGUgKGp1c3QgbGlrZSB0aGUgSGFzaCBvYmplY3QpXG4gICAgLy8gc28gdGhhdCB0aGlzIGNhbiBhbHNvIGJlIG92ZXJyaWRkZW5cbiAgICBpZiAocGFyYW1zLmxlbmd0aCkge1xuICAgICAgcGFyYW1zLmZvckVhY2gocGFyYW0gPT4ge1xuICAgICAgICB0aGlzLmJ1ZmZlciArPSAnICc7XG4gICAgICAgIHRoaXMuRXhwcmVzc2lvbihwYXJhbSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBIYXNoKGhhc2g6IEhhc2gpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5oYW5kbGVkQnlPdmVycmlkZShoYXNoLCB0cnVlKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGhhc2gucGFpcnMuZm9yRWFjaChwYWlyID0+IHtcbiAgICAgIHRoaXMuYnVmZmVyICs9ICcgJztcbiAgICAgIHRoaXMuSGFzaFBhaXIocGFpcik7XG4gICAgfSk7XG4gIH1cblxuICBIYXNoUGFpcihwYWlyOiBIYXNoUGFpcik6IHZvaWQge1xuICAgIGlmICh0aGlzLmhhbmRsZWRCeU92ZXJyaWRlKHBhaXIpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5idWZmZXIgKz0gcGFpci5rZXk7XG4gICAgdGhpcy5idWZmZXIgKz0gJz0nO1xuICAgIHRoaXMuTm9kZShwYWlyLnZhbHVlKTtcbiAgfVxuXG4gIFN0cmluZ0xpdGVyYWwoc3RyOiBTdHJpbmdMaXRlcmFsKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaGFuZGxlZEJ5T3ZlcnJpZGUoc3RyKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuYnVmZmVyICs9IEpTT04uc3RyaW5naWZ5KHN0ci52YWx1ZSk7XG4gIH1cblxuICBCb29sZWFuTGl0ZXJhbChib29sOiBCb29sZWFuTGl0ZXJhbCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmhhbmRsZWRCeU92ZXJyaWRlKGJvb2wpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5idWZmZXIgKz0gYm9vbC52YWx1ZTtcbiAgfVxuXG4gIE51bWJlckxpdGVyYWwobnVtYmVyOiBOdW1iZXJMaXRlcmFsKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaGFuZGxlZEJ5T3ZlcnJpZGUobnVtYmVyKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuYnVmZmVyICs9IG51bWJlci52YWx1ZTtcbiAgfVxuXG4gIFVuZGVmaW5lZExpdGVyYWwobm9kZTogVW5kZWZpbmVkTGl0ZXJhbCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmhhbmRsZWRCeU92ZXJyaWRlKG5vZGUpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5idWZmZXIgKz0gJ3VuZGVmaW5lZCc7XG4gIH1cblxuICBOdWxsTGl0ZXJhbChub2RlOiBOdWxsTGl0ZXJhbCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmhhbmRsZWRCeU92ZXJyaWRlKG5vZGUpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5idWZmZXIgKz0gJ251bGwnO1xuICB9XG5cbiAgcHJpbnQobm9kZTogTm9kZSkge1xuICAgIGxldCB7IG9wdGlvbnMgfSA9IHRoaXM7XG5cbiAgICBpZiAob3B0aW9ucy5vdmVycmlkZSkge1xuICAgICAgbGV0IHJlc3VsdCA9IG9wdGlvbnMub3ZlcnJpZGUobm9kZSwgb3B0aW9ucyk7XG5cbiAgICAgIGlmIChyZXN1bHQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuYnVmZmVyID0gJyc7XG4gICAgdGhpcy5Ob2RlKG5vZGUpO1xuICAgIHJldHVybiB0aGlzLmJ1ZmZlcjtcbiAgfVxufVxuXG5mdW5jdGlvbiB1bnJlYWNoYWJsZShub2RlOiBuZXZlciwgcGFyZW50Tm9kZVR5cGU6IHN0cmluZyk6IG5ldmVyIHtcbiAgbGV0IHsgbG9jLCB0eXBlIH0gPSAobm9kZSBhcyBhbnkpIGFzIE5vZGU7XG4gIHRocm93IG5ldyBFcnJvcihcbiAgICBgTm9uLWV4aGF1c3RpdmUgbm9kZSBuYXJyb3dpbmcgJHt0eXBlfSBAIGxvY2F0aW9uOiAke0pTT04uc3RyaW5naWZ5KFxuICAgICAgbG9jXG4gICAgKX0gZm9yIHBhcmVudCAke3BhcmVudE5vZGVUeXBlfWBcbiAgKTtcbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=